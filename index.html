<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Telemetry Hub | Mission Control</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Prop Types (Required for Recharts UMD) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- Recharts for Visualization -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Styles for F1 Aesthetic -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,600;0,700;1,400&display=swap');
        
        body {
            font-family: 'Titillium Web', sans-serif;
            background-color: #0B0C10;
            color: #C5C6C7;
            overflow-x: hidden;
        }
        
        /* Scrollbar Customization */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1F2833; 
        }
        ::-webkit-scrollbar-thumb {
            background: #45A29E; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #66FCF1; 
        }

        /* F1 Specific Colors */
        .f1-red { color: #e10600; }
        .f1-bg-red { background-color: #e10600; }
        .tyre-soft { color: #ff3333; border-color: #ff3333; }
        .tyre-medium { color: #ffe600; border-color: #ffe600; }
        .tyre-hard { color: #f0f0f0; border-color: #f0f0f0; }
        .tyre-inter { color: #39b54a; border-color: #39b54a; }
        .tyre-wet { color: #0067c4; border-color: #0067c4; }

        .glass-panel {
            background: rgba(31, 40, 51, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(102, 252, 241, 0.1);
        }
        
        /* Table Styles */
        .standings-table th {
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            color: #66FCF1;
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(102, 252, 241, 0.2);
        }
        .standings-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .standings-table tr:hover {
            background-color: rgba(102, 252, 241, 0.05);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;
        
        // Ensure Recharts is loaded safely
        const Recharts = window.Recharts || {};
        const { 
            LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, 
            AreaChart, Area, ScatterChart, Scatter, BarChart, Bar, Cell, RadarChart, PolarGrid, 
            PolarAngleAxis, PolarRadiusAxis, Radar 
        } = Recharts;

        // --- DATA CONSTANTS & LOGIC ---
        
        const YEARS = ['2025', '2024', '2023', '2022'];
        
        const TRACKS = [
            { id: 'bahrain', name: 'Bahrain GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Bahrain_International_Circuit--Grand_Prix_Layout.svg/640px-Bahrain_International_Circuit--Grand_Prix_Layout.svg.png' },
            { id: 'saudi', name: 'Saudi Arabian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Jeddah_Street_Circuit_2021.svg/640px-Jeddah_Street_Circuit_2021.svg.png' },
            { id: 'australia', name: 'Australian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/50/Albert_Lake_Park_Circuit_2021.svg/640px-Albert_Lake_Park_Circuit_2021.svg.png' },
            { id: 'japan', name: 'Japanese GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/Suzuka_circuit_map_2005.svg/640px-Suzuka_circuit_map_2005.svg.png' },
            { id: 'china', name: 'Chinese GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/14/Shanghai_International_Racing_Circuit_track_map.svg/640px-Shanghai_International_Racing_Circuit_track_map.svg.png' },
            { id: 'miami', name: 'Miami GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Miami_International_Autodrome_2022.svg/640px-Miami_International_Autodrome_2022.svg.png' },
            { id: 'imola', name: 'Emilia Romagna GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Imola_2006.svg/640px-Imola_2006.svg.png' },
            { id: 'monaco', name: 'Monaco GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Circuit_de_Monaco_2004.svg/640px-Circuit_de_Monaco_2004.svg.png' },
            { id: 'canada', name: 'Canadian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Circuit_Gilles_Villeneuve_2002.svg/640px-Circuit_Gilles_Villeneuve_2002.svg.png' },
            { id: 'spain', name: 'Spanish GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d8/Catalunya_2021.svg/640px-Catalunya_2021.svg.png' },
            { id: 'austria', name: 'Austrian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/58/Red_Bull_Ring_2018.svg/640px-Red_Bull_Ring_2018.svg.png' },
            { id: 'britain', name: 'British GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Silverstone_Circuit_2020.png/640px-Silverstone_Circuit_2020.png' },
            { id: 'hungary', name: 'Hungarian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Hungaroring_2003.svg/640px-Hungaroring_2003.svg.png' },
            { id: 'belgium', name: 'Belgian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/Circuit_de_Spa-Francorchamps_%282018%29.svg/640px-Circuit_de_Spa-Francorchamps_%282018%29.svg.png' },
            { id: 'netherlands', name: 'Dutch GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Circuit_Zandvoort_2020.svg/640px-Circuit_Zandvoort_2020.svg.png' },
            { id: 'monza', name: 'Italian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/50/Monza_track_map.svg/2560px-Monza_track_map.svg.png' },
            { id: 'baku', name: 'Azerbaijan GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/25/Baku_Formula_One_circuit_map.svg/640px-Baku_Formula_One_circuit_map.svg.png' },
            { id: 'singapore', name: 'Singapore GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Marina_Bay_Street_Circuit_2023.svg/640px-Marina_Bay_Street_Circuit_2023.svg.png' },
            { id: 'austin', name: 'United States GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Austin_circuit.svg/640px-Austin_circuit.svg.png' },
            { id: 'mexico', name: 'Mexico City GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f5/Aut%C3%B3dromo_Hermanos_Rodr%C3%ADguez_2015.svg/640px-Aut%C3%B3dromo_Hermanos_Rodr%C3%ADguez_2015.svg.png' },
            { id: 'brazil', name: 'Sao Paulo GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Circuit_Interlagos.svg/640px-Circuit_Interlagos.svg.png' },
            { id: 'vegas', name: 'Las Vegas GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Las_Vegas_Strip_Circuit_2023.svg/640px-Las_Vegas_Strip_Circuit_2023.svg.png' },
            { id: 'qatar', name: 'Qatar GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Lusail_International_Circuit_2023.svg/640px-Lusail_International_Circuit_2023.svg.png' },
            { id: 'abudhabi', name: 'Abu Dhabi GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Yas_Marina_Circuit_2021.svg/640px-Yas_Marina_Circuit_2021.svg.png' },
        ];

        // --- DYNAMIC DATA GENERATION HELPERS ---

        const getTeamColor = (teamName) => {
            if (teamName.includes('Red Bull')) return '#1E41FF';
            if (teamName.includes('Ferrari')) return '#DC0000';
            if (teamName.includes('Mercedes')) return '#00D2BE';
            if (teamName.includes('McLaren')) return '#FF8700';
            if (teamName.includes('Aston')) return '#006F62';
            if (teamName.includes('Alpine')) return '#0090FF';
            if (teamName.includes('Williams')) return '#005AFF';
            if (teamName.includes('RB') || teamName.includes('AlphaTauri')) return '#1634CC';
            if (teamName.includes('Sauber') || teamName.includes('Alfa')) return '#52E252';
            if (teamName.includes('Haas')) return '#B6BABD';
            return '#999999';
        };

        const getDriverGrid = (year) => {
            const drivers = [];
            // Helper to add driver
            const add = (id, name, team, num) => drivers.push({ id, name, team, number: num, color: getTeamColor(team) });

            if (year === '2025') {
                // REAL WORLD 2025 GRID (Confirmed)
                add('VER', 'Max Verstappen', 'Red Bull Racing', 1);
                add('PER', 'Sergio Perez', 'Red Bull Racing', 11); // CORRECTED: Checo is confirmed for 2025
                add('HAM', 'Lewis Hamilton', 'Ferrari', 44);
                add('LEC', 'Charles Leclerc', 'Ferrari', 16);
                add('NOR', 'Lando Norris', 'McLaren', 4);
                add('PIA', 'Oscar Piastri', 'McLaren', 81);
                add('RUS', 'George Russell', 'Mercedes', 63);
                add('ANT', 'Kimi Antonelli', 'Mercedes', 12);
                add('ALO', 'Fernando Alonso', 'Aston Martin', 14);
                add('STR', 'Lance Stroll', 'Aston Martin', 18);
                add('GAS', 'Pierre Gasly', 'Alpine', 10);
                add('DOO', 'Jack Doohan', 'Alpine', 7);
                add('ALB', 'Alexander Albon', 'Williams', 23);
                add('SAI', 'Carlos Sainz', 'Williams', 55);
                add('TSU', 'Yuki Tsunoda', 'RB', 22);
                add('LAW', 'Liam Lawson', 'RB', 30); // CORRECTED: Lawson at RB (VCARB)
                add('HUL', 'Nico Hulkenberg', 'Sauber', 27);
                add('BOR', 'Gabriel Bortoleto', 'Sauber', 99);
                add('OCO', 'Esteban Ocon', 'Haas', 31);
                add('BEA', 'Ollie Bearman', 'Haas', 87);
            } else if (year === '2024') {
                add('VER', 'Max Verstappen', 'Red Bull Racing', 1);
                add('PER', 'Sergio Perez', 'Red Bull Racing', 11);
                add('HAM', 'Lewis Hamilton', 'Mercedes', 44);
                add('RUS', 'George Russell', 'Mercedes', 63);
                add('LEC', 'Charles Leclerc', 'Ferrari', 16);
                add('SAI', 'Carlos Sainz', 'Ferrari', 55);
                add('NOR', 'Lando Norris', 'McLaren', 4);
                add('PIA', 'Oscar Piastri', 'McLaren', 81);
                add('ALO', 'Fernando Alonso', 'Aston Martin', 14);
                add('STR', 'Lance Stroll', 'Aston Martin', 18);
                add('GAS', 'Pierre Gasly', 'Alpine', 10);
                add('OCO', 'Esteban Ocon', 'Alpine', 31);
                add('ALB', 'Alexander Albon', 'Williams', 23);
                add('SAR', 'Logan Sargeant', 'Williams', 2);
                add('TSU', 'Yuki Tsunoda', 'RB', 22);
                add('RIC', 'Daniel Ricciardo', 'RB', 3);
                add('BOT', 'Valtteri Bottas', 'Sauber', 77);
                add('ZHO', 'Zhou Guanyu', 'Sauber', 24);
                add('HUL', 'Nico Hulkenberg', 'Haas', 27);
                add('MAG', 'Kevin Magnussen', 'Haas', 20);
            } else if (year === '2023') {
                add('VER', 'Max Verstappen', 'Red Bull Racing', 1);
                add('PER', 'Sergio Perez', 'Red Bull Racing', 11);
                add('HAM', 'Lewis Hamilton', 'Mercedes', 44);
                add('RUS', 'George Russell', 'Mercedes', 63);
                add('LEC', 'Charles Leclerc', 'Ferrari', 16);
                add('SAI', 'Carlos Sainz', 'Ferrari', 55);
                add('ALO', 'Fernando Alonso', 'Aston Martin', 14);
                add('STR', 'Lance Stroll', 'Aston Martin', 18);
                add('NOR', 'Lando Norris', 'McLaren', 4);
                add('PIA', 'Oscar Piastri', 'McLaren', 81);
                add('GAS', 'Pierre Gasly', 'Alpine', 10);
                add('OCO', 'Esteban Ocon', 'Alpine', 31);
                add('ALB', 'Alexander Albon', 'Williams', 23);
                add('SAR', 'Logan Sargeant', 'Williams', 2);
                add('TSU', 'Yuki Tsunoda', 'AlphaTauri', 22);
                add('DEV', 'Nyck de Vries', 'AlphaTauri', 21);
                add('BOT', 'Valtteri Bottas', 'Alfa Romeo', 77);
                add('ZHO', 'Zhou Guanyu', 'Alfa Romeo', 24);
                add('HUL', 'Nico Hulkenberg', 'Haas', 27);
                add('MAG', 'Kevin Magnussen', 'Haas', 20);
            } else if (year === '2022') {
                add('VER', 'Max Verstappen', 'Red Bull Racing', 1);
                add('PER', 'Sergio Perez', 'Red Bull Racing', 11);
                add('LEC', 'Charles Leclerc', 'Ferrari', 16);
                add('SAI', 'Carlos Sainz', 'Ferrari', 55);
                add('HAM', 'Lewis Hamilton', 'Mercedes', 44);
                add('RUS', 'George Russell', 'Mercedes', 63);
                add('NOR', 'Lando Norris', 'McLaren', 4);
                add('RIC', 'Daniel Ricciardo', 'McLaren', 3);
                add('ALO', 'Fernando Alonso', 'Alpine', 14);
                add('OCO', 'Esteban Ocon', 'Alpine', 31);
                add('BOT', 'Valtteri Bottas', 'Alfa Romeo', 77);
                add('ZHO', 'Zhou Guanyu', 'Alfa Romeo', 24);
                add('VET', 'Sebastian Vettel', 'Aston Martin', 5);
                add('STR', 'Lance Stroll', 'Aston Martin', 18);
                add('GAS', 'Pierre Gasly', 'AlphaTauri', 10);
                add('TSU', 'Yuki Tsunoda', 'AlphaTauri', 22);
                add('MAG', 'Kevin Magnussen', 'Haas', 20);
                add('MSC', 'Mick Schumacher', 'Haas', 47);
                add('ALB', 'Alexander Albon', 'Williams', 23);
                add('LAT', 'Nicholas Latifi', 'Williams', 6);
            }
            return drivers;
        };

        // --- COMPONENTS ---

        const Icon = ({ name, size = 20, color = "currentColor" }) => {
            const containerRef = useRef(null);

            useEffect(() => {
                if (window.lucide && containerRef.current) {
                    const tempIcon = document.createElement('i');
                    tempIcon.setAttribute('data-lucide', name);
                    containerRef.current.innerHTML = '';
                    containerRef.current.appendChild(tempIcon);
                    window.lucide.createIcons({
                        root: containerRef.current,
                        nameAttr: 'data-lucide',
                        attrs: { width: size, height: size, stroke: color }
                    });
                }
            }, [name, size, color]);

            return <span ref={containerRef} style={{ display: 'inline-flex', width: size, height: size }} />;
        };

        const Card = ({ title, children, className = "" }) => (
            <div className={`glass-panel rounded-xl p-4 flex flex-col h-full ${className}`}>
                <h3 className="text-gray-400 text-sm font-bold uppercase tracking-widest mb-4 flex items-center gap-2">
                    {title}
                </h3>
                <div className="flex-1 min-h-0 relative">
                    {children}
                </div>
            </div>
        );

        const Navbar = ({ activeTab, setActiveTab, selectedYear, setSelectedYear, selectedTrack, setSelectedTrack }) => {
            const tabs = [
                { id: 'overview', label: 'Overview', icon: 'layout-dashboard' },
                { id: 'telemetry', label: 'Telemetry', icon: 'activity' },
                { id: 'strategy', label: 'Strategy', icon: 'git-merge' },
                { id: 'comparison', label: 'Comparison', icon: 'users' },
                { id: 'standings', label: 'Standings', icon: 'trophy' },
            ];

            return (
                <nav className="bg-[#0B0C10] border-b border-gray-800 px-6 py-3 flex flex-col md:flex-row justify-between items-center sticky top-0 z-50 gap-4">
                    <div className="flex items-center gap-3">
                        <div className="w-8 h-8 bg-red-600 rounded-md flex items-center justify-center font-black italic text-white">
                            F1
                        </div>
                        <span className="font-bold text-xl tracking-tighter hidden sm:block">DATA HUB</span>
                    </div>

                    <div className="flex gap-4 items-center">
                        <div className="relative">
                             <select 
                                value={selectedYear}
                                onChange={(e) => setSelectedYear(e.target.value)}
                                className="bg-[#1F2833] text-white text-sm font-bold py-1 px-3 rounded border border-gray-700 focus:border-[#66FCF1] outline-none appearance-none pr-8 cursor-pointer"
                            >
                                {YEARS.map(y => <option key={y} value={y}>{y}</option>)}
                            </select>
                            <div className="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 flex items-center">
                                <Icon name="chevron-down" size={12} />
                            </div>
                        </div>
                         <div className="relative">
                             <select 
                                value={selectedTrack.id}
                                onChange={(e) => setSelectedTrack(TRACKS.find(t => t.id === e.target.value))}
                                className="bg-[#1F2833] text-white text-sm font-bold py-1 px-3 rounded border border-gray-700 focus:border-[#66FCF1] outline-none appearance-none pr-8 cursor-pointer min-w-[160px] max-w-[200px]"
                            >
                                {TRACKS.map(t => <option key={t.id} value={t.id}>{t.name}</option>)}
                            </select>
                            <div className="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 flex items-center">
                                <Icon name="chevron-down" size={12} />
                            </div>
                        </div>
                    </div>

                    <div className="flex gap-2 bg-[#1F2833] p-1 rounded-lg overflow-x-auto max-w-full">
                        {tabs.map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id)}
                                className={`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap ${
                                    activeTab === tab.id 
                                    ? 'bg-[#66FCF1] text-[#0B0C10] shadow-lg shadow-[#66FCF1]/20' 
                                    : 'text-gray-400 hover:text-white hover:bg-white/5'
                                }`}
                            >
                                <Icon name={tab.icon} size={16} />
                                {tab.label}
                            </button>
                        ))}
                    </div>
                </nav>
            );
        };

        const StandingsView = ({ year, drivers }) => {
            const [viewType, setViewType] = useState('drivers'); // 'drivers' or 'constructors'

            // Dynamic calculation based on Real-ish historical data logic
            const data = useMemo(() => {
                
                // Create copies to avoid mutating prop
                let driverStandings = drivers.map(d => {
                    let pts = 0;
                    
                    // 2022 Logic (Max Dom, Leclerc 2nd, Checo 3rd)
                    if (year === '2022') {
                        if(d.id === 'VER') pts = 454;
                        else if(d.id === 'LEC') pts = 308;
                        else if(d.id === 'PER') pts = 305;
                        else if(d.id === 'RUS') pts = 275;
                        else if(d.id === 'SAI') pts = 246;
                        else if(d.id === 'HAM') pts = 240;
                        else if(d.id === 'NOR') pts = 122;
                        else pts = Math.floor(Math.random() * 100);
                    }
                    // 2023 Logic (Max Hyper Dom, Checo 2nd, Ham 3rd)
                    else if (year === '2023') {
                        if(d.id === 'VER') pts = 575;
                        else if(d.id === 'PER') pts = 285;
                        else if(d.id === 'HAM') pts = 234;
                        else if(d.id === 'ALO') pts = 206;
                        else if(d.id === 'LEC') pts = 206;
                        else if(d.id === 'NOR') pts = 205;
                        else if(d.id === 'SAI') pts = 200;
                        else pts = Math.floor(Math.random() * 100);
                    }
                    // 2024 Logic (Max vs Lando vs Charles)
                    else if (year === '2024') {
                         if(d.id === 'VER') pts = 393;
                        else if(d.id === 'NOR') pts = 331;
                        else if(d.id === 'LEC') pts = 307;
                        else if(d.id === 'PIA') pts = 262;
                        else if(d.id === 'SAI') pts = 244;
                        else if(d.id === 'HAM') pts = 190;
                         else if(d.id === 'RUS') pts = 192;
                        else pts = Math.floor(Math.random() * 80);
                    }
                    // 2025 Logic (Hypothetical Battle)
                    else {
                         if(d.id === 'HAM') pts = 380; // Lewis Ferrari Hype
                        else if(d.id === 'VER') pts = 375;
                        else if(d.id === 'LEC') pts = 360;
                        else if(d.id === 'NOR') pts = 340;
                        else if(d.id === 'PIA') pts = 290;
                        else if(d.id === 'RUS') pts = 210;
                        else if(d.id === 'SAI') pts = 180; // Sainz at Williams doing well
                        else if(d.id === 'PER') pts = 165; // Checo
                        else if(d.id === 'ANT') pts = 120; // Antonelli rookie
                        else pts = Math.floor(Math.random() * 100);
                    }

                    return { ...d, points: pts, wins: Math.floor(pts/30), podiums: Math.floor(pts/15) };
                }).sort((a, b) => b.points - a.points);

                driverStandings = driverStandings.map((d, i) => ({ ...d, rank: i + 1 }));

                // Construct Team Standings from Driver Points
                const teamMap = {};
                driverStandings.forEach(d => {
                    if(!teamMap[d.team]) {
                        teamMap[d.team] = { 
                            id: d.team.replace(/\s+/g, '').toLowerCase(),
                            name: d.team, 
                            points: 0, 
                            wins: 0,
                            color: d.color
                        };
                    }
                    teamMap[d.team].points += d.points;
                    teamMap[d.team].wins += d.wins;
                });
                
                let constructorStandings = Object.values(teamMap).sort((a, b) => b.points - a.points);
                constructorStandings = constructorStandings.map((c, i) => ({ ...c, rank: i + 1 }));

                return { drivers: driverStandings, constructors: constructorStandings };
            }, [year, drivers]);

            return (
                <div className="h-full flex flex-col gap-4">
                    <div className="flex gap-4 justify-center mb-4">
                        <button 
                            onClick={() => setViewType('drivers')}
                            className={`px-6 py-2 rounded-full font-bold text-sm transition-all ${viewType === 'drivers' ? 'bg-[#e10600] text-white' : 'bg-gray-800 text-gray-400 hover:bg-gray-700'}`}
                        >
                            DRIVER STANDINGS
                        </button>
                        <button 
                            onClick={() => setViewType('constructors')}
                            className={`px-6 py-2 rounded-full font-bold text-sm transition-all ${viewType === 'constructors' ? 'bg-[#e10600] text-white' : 'bg-gray-800 text-gray-400 hover:bg-gray-700'}`}
                        >
                            CONSTRUCTOR STANDINGS
                        </button>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
                        {/* Main Table */}
                        <div className="lg:col-span-2 h-full overflow-hidden flex flex-col">
                             <Card title={`World Championship Standings - ${year}`}>
                                <div className="overflow-y-auto h-full pr-2">
                                    <table className="w-full standings-table text-sm">
                                        <thead>
                                            <tr>
                                                <th className="w-16 text-center">Pos</th>
                                                <th>{viewType === 'drivers' ? 'Driver' : 'Team'}</th>
                                                {viewType === 'drivers' && <th>Team</th>}
                                                <th className="text-right">Wins</th>
                                                {viewType === 'drivers' && <th className="text-right">Podiums</th>}
                                                <th className="text-right">Points</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {(viewType === 'drivers' ? data.drivers : data.constructors).map((item) => (
                                                <tr key={item.rank} className="group transition-colors">
                                                    <td className="text-center font-mono font-bold text-xl text-gray-500 group-hover:text-white">
                                                        {item.rank}
                                                    </td>
                                                    <td>
                                                        <div className="flex items-center gap-3">
                                                            <div className="w-1 h-8 rounded-full" style={{ backgroundColor: item.color }}></div>
                                                            <div>
                                                                <div className="font-bold text-white text-lg">{item.name}</div>
                                                                {viewType === 'drivers' && <div className="text-xs text-gray-400">#{item.number}</div>}
                                                            </div>
                                                        </div>
                                                    </td>
                                                    {viewType === 'drivers' && <td className="text-gray-300">{item.team}</td>}
                                                    <td className="text-right font-mono text-gray-400">{item.wins}</td>
                                                    {viewType === 'drivers' && <td className="text-right font-mono text-gray-400">{item.podiums}</td>}
                                                    <td className="text-right">
                                                        <span className="bg-[#1F2833] px-3 py-1 rounded-md font-mono font-bold text-[#66FCF1]">
                                                            {item.points} PTS
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </Card>
                        </div>

                        {/* Stats / Visuals Sidebar */}
                        <div className="flex flex-col gap-6">
                            <Card title="Championship Battle">
                                <ResponsiveContainer width="100%" height={250}>
                                    <BarChart data={(viewType === 'drivers' ? data.drivers : data.constructors).slice(0, 5)} layout="vertical">
                                        <CartesianGrid strokeDasharray="3 3" stroke="#333" horizontal={false} />
                                        <XAxis type="number" hide />
                                        <YAxis dataKey="name" type="category" hide />
                                        <Tooltip 
                                            contentStyle={{ backgroundColor: '#1F2833', border: '1px solid #45A29E' }} 
                                            cursor={{fill: 'transparent'}}
                                        />
                                        <Bar dataKey="points" radius={[0, 4, 4, 0]}>
                                            {
                                                (viewType === 'drivers' ? data.drivers : data.constructors).slice(0, 5).map((entry, index) => (
                                                    <Cell key={`cell-${index}`} fill={entry.color} />
                                                ))
                                            }
                                        </Bar>
                                    </BarChart>
                                </ResponsiveContainer>
                            </Card>
                            
                            <div className="grid grid-cols-2 gap-4">
                                <div className="bg-[#1F2833] p-4 rounded-lg text-center border-t-4 border-[#66FCF1]">
                                    <div className="text-gray-400 text-xs uppercase mb-1">Leader</div>
                                    <div className="font-bold text-white text-lg truncate">
                                        {viewType === 'drivers' ? data.drivers[0].name : data.constructors[0].name}
                                    </div>
                                </div>
                                <div className="bg-[#1F2833] p-4 rounded-lg text-center border-t-4 border-gray-600">
                                    <div className="text-gray-400 text-xs uppercase mb-1">Gap to 2nd</div>
                                    <div className="font-mono text-[#66FCF1] text-xl font-bold">
                                        {data.drivers[0].points - data.drivers[1].points} PTS
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const TelemetryView = ({ data, drivers }) => {
            const [selectedDrivers, setSelectedDrivers] = useState([]);
            
            // Initialize default selection when drivers prop changes
            useEffect(() => {
                if (drivers && drivers.length > 0) {
                     // Default to first two drivers (usually top contenders)
                    setSelectedDrivers([drivers[0].id, drivers[4]?.id || drivers[1].id]);
                }
            }, [drivers]);

            if (!LineChart) return <div className="p-4 text-red-500">Error loading charts. Please refresh.</div>;

            const handleDriverToggle = (driverId) => {
                if (selectedDrivers.includes(driverId)) {
                    if (selectedDrivers.length > 1) {
                        setSelectedDrivers(prev => prev.filter(id => id !== driverId));
                    }
                } else {
                    if (selectedDrivers.length < 4) { 
                        setSelectedDrivers(prev => [...prev, driverId]);
                    }
                }
            };

            return (
                <div className="grid grid-cols-1 lg:grid-cols-4 gap-6 h-full">
                    <div className="lg:col-span-3 flex flex-col gap-6">
                        <Card title="Speed Trace (km/h)">
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={data}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                    <XAxis dataKey="distance" type="number" domain={[0, 100]} hide />
                                    <YAxis domain={['auto', 'auto']} stroke="#666" />
                                    <Tooltip 
                                        contentStyle={{ backgroundColor: '#1F2833', border: '1px solid #45A29E' }}
                                        labelFormatter={(label) => `Distance: ${label}%`}
                                    />
                                    <Legend />
                                    {selectedDrivers.map(id => {
                                        const driver = drivers.find(d => d.id === id);
                                        if (!driver) return null;
                                        return (
                                            <Line 
                                                key={id}
                                                type="monotone" 
                                                dataKey={`${id}_speed`} 
                                                stroke={driver.color} 
                                                dot={false} 
                                                strokeWidth={2} 
                                                name={`${id} Speed`} 
                                            />
                                        );
                                    })}
                                </LineChart>
                            </ResponsiveContainer>
                        </Card>
                        
                        <div className="grid grid-cols-2 gap-6 h-64">
                            <Card title="Throttle Input (%)">
                                <ResponsiveContainer width="100%" height="100%">
                                    <LineChart data={data}>
                                        <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                        <XAxis dataKey="distance" hide />
                                        <YAxis domain={[0, 100]} hide />
                                        <Tooltip contentStyle={{ backgroundColor: '#1F2833', border: '1px solid #45A29E' }}/>
                                        {selectedDrivers.map(id => {
                                             const driver = drivers.find(d => d.id === id);
                                             if (!driver) return null;
                                            return (
                                                <Line 
                                                    key={id}
                                                    type="step" 
                                                    dataKey={`${id}_throttle`} 
                                                    stroke={driver.color} 
                                                    dot={false} 
                                                    strokeWidth={2} 
                                                    name={id}
                                                />
                                            );
                                        })}
                                    </LineChart>
                                </ResponsiveContainer>
                            </Card>
                            <Card title="Brake Pressure">
                                <ResponsiveContainer width="100%" height="100%">
                                    <LineChart data={data}>
                                        <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                        <XAxis dataKey="distance" hide />
                                        <YAxis domain={[0, 100]} hide />
                                        <Tooltip contentStyle={{ backgroundColor: '#1F2833', border: '1px solid #45A29E' }}/>
                                        {selectedDrivers.map(id => {
                                             const driver = drivers.find(d => d.id === id);
                                             if (!driver) return null;
                                            return (
                                                <Line 
                                                    key={id}
                                                    type="monotone" 
                                                    dataKey={`${id}_brake`} 
                                                    stroke={driver.color} 
                                                    dot={false} 
                                                    strokeWidth={2} 
                                                    name={id}
                                                />
                                            );
                                        })}
                                    </LineChart>
                                </ResponsiveContainer>
                            </Card>
                        </div>
                    </div>
                    
                    <div className="flex flex-col gap-4 h-full">
                        <Card title="Driver Select" className="flex flex-col">
                            <div className="flex-1 overflow-y-auto pr-2 space-y-2 max-h-[600px]">
                                {drivers.map(d => (
                                    <button
                                        key={d.id}
                                        onClick={() => handleDriverToggle(d.id)}
                                        className={`w-full p-2 rounded flex items-center justify-between border transition-all text-sm ${
                                            selectedDrivers.includes(d.id) 
                                            ? 'bg-white/10 border-[#66FCF1]' 
                                            : 'border-transparent hover:bg-white/5 border-gray-800'
                                        }`}
                                    >
                                        <div className="flex items-center gap-3">
                                            <div className="w-1 h-6 rounded-full" style={{ backgroundColor: d.color }}></div>
                                            <div className="text-left">
                                                <div className="font-bold text-white leading-none">{d.id}</div>
                                                <div className="text-[10px] text-gray-400">{d.team}</div>
                                            </div>
                                        </div>
                                        {selectedDrivers.includes(d.id) && <Icon name="check" size={14} color="#66FCF1" />}
                                    </button>
                                ))}
                            </div>
                            <div className="mt-4 text-[10px] text-gray-500 p-2 border border-gray-800 rounded">
                                <span className="text-[#66FCF1] font-bold">INFO:</span> Select up to 4 drivers.
                            </div>
                        </Card>
                    </div>
                </div>
            );
        };

        const StrategyView = ({ lapData, stintData, drivers }) => {
            if (!ScatterChart) return <div className="p-4 text-red-500">Error loading charts. Please refresh.</div>;

            // Process data for Position History and Tyre Deg
            const processedData = useMemo(() => {
                const positionHistory = [];
                const tyreDegData = [];
                const cumulative = {};
                
                // Group lap times by lap number
                const lapsByNumber = {};
                lapData.forEach(l => {
                    if(!lapsByNumber[l.lap]) lapsByNumber[l.lap] = [];
                    lapsByNumber[l.lap].push(l);
                    
                    // Add to tyre deg dataset (using random tyre age for demo if not in data)
                    // We estimate tyre age based on simple logic: lap number % 20
                    const estTyreAge = (l.lap % 22) + 1;
                    tyreDegData.push({
                        ...l,
                        tyreAge: estTyreAge,
                        compound: l.tyre || (estTyreAge > 15 ? 'Hard' : 'Medium') 
                    });
                });

                // Calculate positions per lap
                Object.keys(lapsByNumber).sort((a,b) => a-b).forEach(lapNum => {
                    const currentLaps = lapsByNumber[lapNum];
                    
                    // Update cumulative times
                    currentLaps.forEach(l => {
                        cumulative[l.driver] = (cumulative[l.driver] || 0) + l.time;
                    });

                    // Sort drivers by cumulative time to determine position
                    const sortedDrivers = Object.entries(cumulative)
                        .sort(([,timeA], [,timeB]) => timeA - timeB)
                        .map(([driver]) => driver);

                    const lapPos = { lap: parseInt(lapNum) };
                    sortedDrivers.forEach((d, idx) => {
                        lapPos[d] = idx + 1;
                    });
                    positionHistory.push(lapPos);
                });

                return { positionHistory, tyreDegData };
            }, [lapData]);

            // Filter for top 5 drivers for readability in complex charts
            const topDrivers = drivers.slice(0, 5);

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
                    {/* Row 1: Stint Overview (Span full width) */}
                    <div className="lg:col-span-3 h-48">
                        <Card title="Tyre Strategy Overview">
                            <div className="w-full h-full flex flex-col justify-around px-4 overflow-y-auto">
                                {stintData.slice(0, 8).map((d, idx) => (
                                    <div key={idx} className="flex items-center gap-4 mb-2">
                                        <div className="w-16 font-bold text-white text-right text-xs">{d.driver}</div>
                                        <div className="flex-1 h-6 bg-gray-800 rounded-full relative overflow-hidden flex">
                                            {d.stints.map((stint, sIdx) => {
                                                const totalLaps = 53;
                                                const width = ((stint.end - stint.start) / totalLaps) * 100;
                                                const color = stint.tyre === 'S' ? '#ff3333' : stint.tyre === 'M' ? '#ffe600' : '#f0f0f0';
                                                return (
                                                    <div 
                                                        key={sIdx} 
                                                        style={{ width: `${width}%`, backgroundColor: color }}
                                                        className="h-full border-r border-black/20 flex items-center justify-center text-[9px] text-black font-bold relative group cursor-help"
                                                    >
                                                        {stint.tyre}
                                                        <div className="absolute bottom-full mb-1 hidden group-hover:block bg-black text-white text-xs p-2 rounded z-10 whitespace-nowrap shadow-lg border border-gray-700">
                                                            <div className="font-bold">Stint {sIdx + 1}</div>
                                                            <div>Laps: {stint.start}-{stint.end}</div>
                                                            <div>Compound: {stint.tyre === 'S' ? 'Soft' : stint.tyre === 'M' ? 'Medium' : 'Hard'}</div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </Card>
                    </div>

                    {/* Row 2: Race History (Position Changes) */}
                    <div className="lg:col-span-2 h-80">
                        <Card title="Race History Chart (Position)">
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={processedData.positionHistory}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                    <XAxis dataKey="lap" type="number" label={{ value: 'Lap', position: 'insideBottomRight', offset: -5 }} stroke="#666" />
                                    <YAxis reversed domain={[1, 10]} width={30} stroke="#666" />
                                    <Tooltip 
                                        contentStyle={{ backgroundColor: '#1F2833', border: '1px solid #45A29E' }}
                                        labelFormatter={(l) => `Lap ${l}`}
                                    />
                                    <Legend />
                                    {topDrivers.map((d) => (
                                        <Line 
                                            key={d.id}
                                            type="monotone" 
                                            dataKey={d.id} 
                                            stroke={d.color} 
                                            strokeWidth={3}
                                            dot={false}
                                            activeDot={{ r: 6 }}
                                        />
                                    ))}
                                </LineChart>
                            </ResponsiveContainer>
                        </Card>
                    </div>

                    {/* Row 2: Gap to Leader */}
                    <div className="lg:col-span-1 h-80">
                        <Card title="Gap to Leader">
                            <ResponsiveContainer width="100%" height="100%">
                                <AreaChart data={lapData.filter(l => l.driver === (drivers[1]?.id || 'NOR') && l.lap <= 30)}>
                                    <defs>
                                        <linearGradient id="colorGap" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor="#66FCF1" stopOpacity={0.8}/>
                                            <stop offset="95%" stopColor="#66FCF1" stopOpacity={0}/>
                                        </linearGradient>
                                    </defs>
                                    <XAxis dataKey="lap" stroke="#666" />
                                    <YAxis label={{ value: 'Gap (s)', angle: -90, position: 'insideLeft' }} stroke="#666" />
                                    <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                    <Tooltip contentStyle={{ backgroundColor: '#1F2833' }}/>
                                    <Area type="monotone" dataKey="time" stroke="#66FCF1" fillOpacity={1} fill="url(#colorGap)" name="Gap" />
                                </AreaChart>
                            </ResponsiveContainer>
                        </Card>
                    </div>

                    {/* Row 3: Tyre Degradation Analysis */}
                    <div className="lg:col-span-2 h-80">
                        <Card title="Tyre Degradation Analysis (Lap Time vs Tyre Age)">
                            <ResponsiveContainer width="100%" height="100%">
                                <ScatterChart>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                    <XAxis type="number" dataKey="tyreAge" name="Tyre Age" unit=" Laps" stroke="#666" />
                                    <YAxis type="number" dataKey="time" name="Lap Time" domain={['auto', 'auto']} stroke="#666" />
                                    <Tooltip cursor={{ strokeDasharray: '3 3' }} contentStyle={{ backgroundColor: '#1F2833' }} />
                                    <Legend />
                                    {/* Render Scatters for each compound using mock separation logic */}
                                    <Scatter name="Soft" data={processedData.tyreDegData.filter(d => d.lap < 15)} fill="#ff3333" />
                                    <Scatter name="Medium" data={processedData.tyreDegData.filter(d => d.lap >= 15 && d.lap < 35)} fill="#ffe600" />
                                    <Scatter name="Hard" data={processedData.tyreDegData.filter(d => d.lap >= 35)} fill="#ffffff" />
                                </ScatterChart>
                            </ResponsiveContainer>
                        </Card>
                    </div>

                    {/* Row 3: Strategy Info */}
                    <div className="lg:col-span-1 h-80">
                        <Card title="Strategy Predictions">
                            <div className="flex flex-col justify-between h-full p-2">
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center border-b border-gray-800 pb-2">
                                        <span className="text-gray-400 text-sm">Optimal Pit Window</span>
                                        <span className="text-[#66FCF1] font-bold font-mono">Laps 22-25</span>
                                    </div>
                                    <div className="flex justify-between items-center border-b border-gray-800 pb-2">
                                        <span className="text-gray-400 text-sm">Undercut Power</span>
                                        <span className="text-red-500 font-bold font-mono">High (2.5s)</span>
                                    </div>
                                    <div className="flex justify-between items-center border-b border-gray-800 pb-2">
                                        <span className="text-gray-400 text-sm">Safety Car Probability</span>
                                        <span className="text-yellow-500 font-bold font-mono">45%</span>
                                    </div>
                                </div>
                                
                                <div className="mt-4 bg-black/30 p-3 rounded-lg border border-gray-700">
                                    <h4 className="text-white text-sm font-bold mb-2">Projected Strategy</h4>
                                    <div className="flex items-center gap-2 text-xs">
                                        <span className="w-4 h-4 rounded-full bg-[#ffe600] inline-block"></span> Medium (Start)
                                        <Icon name="arrow-right" size={12} />
                                        <span className="w-4 h-4 rounded-full bg-[#f0f0f0] inline-block"></span> Hard (Lap 24)
                                    </div>
                                </div>
                            </div>
                        </Card>
                    </div>
                </div>
            );
        };

        const Leaderboard = ({ drivers }) => (
            <Card title="Live Standings (Lap 53/53)" className="overflow-hidden">
                <div className="overflow-y-auto pr-2">
                    <table className="w-full text-sm">
                        <thead className="text-xs text-gray-500 border-b border-gray-700">
                            <tr>
                                <th className="text-left py-2">Pos</th>
                                <th className="text-left py-2">Driver</th>
                                <th className="text-right py-2">Gap</th>
                                <th className="text-center py-2">Tyre</th>
                                <th className="text-right py-2">Last Lap</th>
                            </tr>
                        </thead>
                        <tbody>
                            {drivers.slice(0, 10).map((d, i) => (
                                <tr key={d.id} className="border-b border-white/5 hover:bg-white/5 transition-colors">
                                    <td className="py-3 font-mono text-[#66FCF1] font-bold">{i + 1}</td>
                                    <td className="py-3">
                                        <div className="flex items-center gap-2">
                                            <span className="w-1 h-4" style={{ backgroundColor: d.color }}></span>
                                            <span className="font-bold text-white">{d.name.split(' ')[1]}</span>
                                            <span className="text-xs text-gray-500">{d.team.substring(0, 3).toUpperCase()}</span>
                                        </div>
                                    </td>
                                    <td className="py-3 text-right font-mono text-gray-300">
                                        {i === 0 ? 'Leader' : `+${(Math.random() * 5 + (i * 2)).toFixed(3)}`}
                                    </td>
                                    <td className="py-3 text-center">
                                        <span className={`inline-block w-6 h-6 rounded-full border-4 flex items-center justify-center text-[10px] font-bold bg-gray-900 ${
                                            i % 2 === 0 ? 'tyre-hard' : 'tyre-medium'
                                        }`}>
                                            {i % 2 === 0 ? 'H' : 'M'}
                                        </span>
                                    </td>
                                    <td className="py-3 text-right font-mono text-[#66FCF1]">
                                        1:22.{Math.floor(Math.random() * 900)}
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </Card>
        );

        const ComparisonView = ({ drivers }) => {
            const [d1, setD1] = useState(drivers[0]);
            const [d2, setD2] = useState(drivers[1] || drivers[0]);

            useEffect(() => {
                setD1(drivers[0]);
                setD2(drivers[1] || drivers[0]);
            }, [drivers]);

            const getStats = (dId) => {
                const seed = dId.charCodeAt(0) + dId.charCodeAt(1) + dId.charCodeAt(2);
                const r = (n) => (Math.sin(seed * n) * 40) + 100; 
                return {
                    qp: Math.min(145, Math.max(70, r(1))),
                    rp: Math.min(145, Math.max(70, r(2))),
                    tm: Math.min(145, Math.max(70, r(3))),
                    ov: Math.min(145, Math.max(70, r(4))),
                    cn: Math.min(145, Math.max(70, r(5))),
                    df: Math.min(145, Math.max(70, r(6)))
                };
            };

            if (!d1 || !d2) return <div>Loading...</div>;

            const stats1 = getStats(d1.id);
            const stats2 = getStats(d2.id);

            const radarData = [
                { subject: 'Quali Pace', A: stats1.qp, B: stats2.qp, fullMark: 150 },
                { subject: 'Race Pace', A: stats1.rp, B: stats2.rp, fullMark: 150 },
                { subject: 'Tyre Mgmt', A: stats1.tm, B: stats2.tm, fullMark: 150 },
                { subject: 'Overtaking', A: stats1.ov, B: stats2.ov, fullMark: 150 },
                { subject: 'Consistency', A: stats1.cn, B: stats2.cn, fullMark: 150 },
                { subject: 'Defense', A: stats1.df, B: stats2.df, fullMark: 150 },
            ];

            const barData = [
                { range: '1:21', [d1.id]: Math.floor(stats1.qp/10), [d2.id]: Math.floor(stats2.qp/10) },
                { range: '1:22', [d1.id]: Math.floor(stats1.rp/6), [d2.id]: Math.floor(stats2.rp/6) },
                { range: '1:23', [d1.id]: Math.floor(stats1.tm/4), [d2.id]: Math.floor(stats2.tm/4) },
                { range: '1:24+', [d1.id]: Math.floor(stats1.cn/10), [d2.id]: Math.floor(stats2.cn/10) },
            ];
            
            if (!RadarChart) return <div className="p-4 text-red-500">Error loading charts. Please refresh.</div>;

            return (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 h-full">
                    <Card title="Driver Head-to-Head Selector">
                        <div className="flex justify-between items-center mb-4 px-4 gap-4">
                            <div className="flex-1">
                                <select 
                                    className="w-full bg-[#1F2833] text-white p-2 rounded border border-gray-700 mb-2 font-bold"
                                    value={d1.id}
                                    onChange={(e) => setD1(drivers.find(d => d.id === e.target.value))}
                                >
                                    {drivers.map(d => <option key={d.id} value={d.id}>{d.name}</option>)}
                                </select>
                                <div className="text-center">
                                    <div className="w-20 h-20 mx-auto rounded-full flex items-center justify-center text-2xl font-bold border-4 shadow-[0_0_20px_rgba(255,255,255,0.1)]" 
                                         style={{ borderColor: d1.color, background: `linear-gradient(135deg, ${d1.color}44, ${d1.color}88)` }}>
                                        {d1.number}
                                    </div>
                                    <h2 className="mt-2 text-xl font-bold text-white">{d1.id}</h2>
                                    <p className="text-xs text-gray-400">{d1.team}</p>
                                </div>
                            </div>

                            <div className="text-2xl font-black italic text-gray-600">VS</div>

                            <div className="flex-1">
                                <select 
                                    className="w-full bg-[#1F2833] text-white p-2 rounded border border-gray-700 mb-2 font-bold"
                                    value={d2.id}
                                    onChange={(e) => setD2(drivers.find(d => d.id === e.target.value))}
                                >
                                    {drivers.map(d => <option key={d.id} value={d.id}>{d.name}</option>)}
                                </select>
                                <div className="text-center">
                                    <div className="w-20 h-20 mx-auto rounded-full flex items-center justify-center text-2xl font-bold border-4 shadow-[0_0_20px_rgba(255,255,255,0.1)]" 
                                         style={{ borderColor: d2.color, background: `linear-gradient(135deg, ${d2.color}44, ${d2.color}88)` }}>
                                        {d2.number}
                                    </div>
                                    <h2 className="mt-2 text-xl font-bold text-white">{d2.id}</h2>
                                    <p className="text-xs text-gray-400">{d2.team}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div className="h-64">
                            <ResponsiveContainer width="100%" height="100%">
                                <RadarChart cx="50%" cy="50%" outerRadius="80%" data={radarData}>
                                    <PolarGrid stroke="#333" />
                                    <PolarAngleAxis dataKey="subject" tick={{ fill: '#999', fontSize: 12 }} />
                                    <PolarRadiusAxis angle={30} domain={[0, 150]} tick={false} axisLine={false} />
                                    <Radar name={d1.name} dataKey="A" stroke={d1.color} strokeWidth={2} fill={d1.color} fillOpacity={0.3} />
                                    <Radar name={d2.name} dataKey="B" stroke={d2.color} strokeWidth={2} fill={d2.color} fillOpacity={0.3} />
                                    <Legend />
                                </RadarChart>
                            </ResponsiveContainer>
                        </div>
                    </Card>

                    <div className="flex flex-col gap-6">
                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-[#1F2833] p-4 rounded-lg border-l-4" style={{ borderColor: d1.color }}>
                                <p className="text-gray-400 text-xs uppercase">{d1.id} Best Lap</p>
                                <p className="text-2xl font-mono text-white">1:21.{(stats1.qp * 10).toFixed(0)}</p>
                            </div>
                            <div className="bg-[#1F2833] p-4 rounded-lg border-l-4" style={{ borderColor: d2.color }}>
                                <p className="text-gray-400 text-xs uppercase">{d2.id} Best Lap</p>
                                <p className="text-2xl font-mono text-white">1:21.{(stats2.qp * 10).toFixed(0)}</p>
                            </div>
                            <div className="bg-[#1F2833] p-4 rounded-lg border-l-4" style={{ borderColor: d1.color }}>
                                <p className="text-gray-400 text-xs uppercase">{d1.id} Avg Speed</p>
                                <p className="text-2xl font-mono text-white">{Math.floor(stats1.rp * 1.8)} km/h</p>
                            </div>
                            <div className="bg-[#1F2833] p-4 rounded-lg border-l-4" style={{ borderColor: d2.color }}>
                                <p className="text-gray-400 text-xs uppercase">{d2.id} Avg Speed</p>
                                <p className="text-2xl font-mono text-white">{Math.floor(stats2.rp * 1.8)} km/h</p>
                            </div>
                        </div>
                        <Card title="Lap Time Distribution Comparison">
                             <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={barData}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#333" vertical={false} />
                                    <XAxis dataKey="range" stroke="#666" />
                                    <Tooltip cursor={{fill: 'transparent'}} contentStyle={{ backgroundColor: '#1F2833' }} />
                                    <Legend />
                                    <Bar dataKey={d1.id} fill={d1.color} radius={[4, 4, 0, 0]} name={d1.id} />
                                    <Bar dataKey={d2.id} fill={d2.color} radius={[4, 4, 0, 0]} name={d2.id} />
                                </BarChart>
                            </ResponsiveContainer>
                        </Card>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('overview');
            const [selectedYear, setSelectedYear] = useState('2025');
            const [selectedTrack, setSelectedTrack] = useState(TRACKS[0]);

            // 1. Get Correct Drivers for Year
            const currentDrivers = useMemo(() => getDriverGrid(selectedYear), [selectedYear]);

            const telemetryData = useMemo(() => {
                const data = [];
                for (let i = 0; i <= 100; i++) {
                    const dist = i;
                    let baseSpeed = 0, throttle = 0, brake = 0;

                    const trackFactor = selectedTrack.id === 'monaco' ? 0.7 : 1.0; 

                    if (dist < 20) { 
                        baseSpeed = (100 + (dist * 10)) * trackFactor; 
                        throttle = 100; brake = 0;
                    } else if (dist < 30) { 
                        baseSpeed = (300 - ((dist - 20) * 20)) * trackFactor;
                        throttle = 0; brake = 100;
                    } else if (dist < 50) { 
                        baseSpeed = (100 + ((dist - 30) * 8)) * trackFactor;
                        throttle = 80; brake = 0;
                    } else if (dist < 70) { 
                        baseSpeed = (260 - ((dist - 50) * 2)) * trackFactor;
                        throttle = 60; brake = 10;
                    } else { 
                        baseSpeed = (220 + ((dist - 70) * 5)) * trackFactor;
                        throttle = 100; brake = 0;
                    }
                    
                    const point = { distance: dist };
                    
                    currentDrivers.forEach(d => {
                        const jitter = (d.id.charCodeAt(0) % 5) - 2.5; 
                        point[`${d.id}_speed`] = baseSpeed + jitter + (Math.random() * 4);
                        point[`${d.id}_throttle`] = throttle > 0 ? Math.min(100, throttle + jitter) : 0;
                        point[`${d.id}_brake`] = brake > 0 ? Math.min(100, brake - jitter) : 0;
                    });

                    data.push(point);
                }
                return data;
            }, [selectedTrack.id, selectedYear, currentDrivers]);

            const lapData = useMemo(() => {
                const laps = [];
                const baseTime = selectedTrack.id === 'spa' ? 104.0 : selectedTrack.id === 'monaco' ? 72.0 : 82.5;
                
                currentDrivers.forEach(driver => {
                    let currentTyre = 'Medium';
                    let tyreAge = 0;
                    for (let i = 1; i <= 50; i++) {
                        if (i === 20) currentTyre = 'Hard';
                        let time = baseTime + (tyreAge * 0.05) - (i * 0.03) + (Math.random() - 0.5) * 0.4;
                        if (i === 20) time += 20;
                        tyreAge++;
                        if (i === 20) tyreAge = 0;
                        laps.push({ lap: i, driver: driver.id, time: parseFloat(time.toFixed(3)), tyre: currentTyre });
                    }
                });
                return laps;
            }, [selectedTrack.id, selectedYear, currentDrivers]);

            const stintData = useMemo(() => {
                return currentDrivers.map((d, i) => ({
                    driver: d.id,
                    stints: i % 2 === 0 
                        ? [{ start: 1, end: 22, tyre: 'M' }, { start: 23, end: 53, tyre: 'H' }]
                        : [{ start: 1, end: 18, tyre: 'S' }, { start: 19, end: 40, tyre: 'H' }, { start: 41, end: 53, tyre: 'S' }]
                }));
            }, [selectedYear, currentDrivers]);

            return (
                <div className="min-h-screen bg-[#0B0C10] pb-8">
                    <Navbar 
                        activeTab={activeTab} 
                        setActiveTab={setActiveTab} 
                        selectedYear={selectedYear}
                        setSelectedYear={setSelectedYear}
                        selectedTrack={selectedTrack}
                        setSelectedTrack={setSelectedTrack}
                    />
                    
                    <main className="container mx-auto px-6 py-8 h-[calc(100vh-80px)]">
                        {activeTab === 'overview' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
                                <div className="lg:col-span-2 h-full">
                                    <Card title="Track Dominance Map (Sector Analysis)">
                                        <div className="w-full h-full flex items-center justify-center relative overflow-hidden">
                                            <div 
                                                className="absolute inset-0 bg-contain bg-no-repeat bg-center opacity-80 hover:opacity-100 transition-opacity duration-500"
                                                style={{ backgroundImage: `url('${selectedTrack.map}')` }}
                                            ></div>
                                            <div className="absolute inset-0 bg-black/40 pointer-events-none"></div>
                                            <div className="relative z-10 text-center mt-auto mb-4">
                                                <h2 className="text-4xl font-black italic text-white mb-2 uppercase">{selectedTrack.name}</h2>
                                                <div className="flex gap-4 justify-center">
                                                    {/* Dynamic Sector Leaders */}
                                                    <span className="px-2 py-1 bg-[#1E41FF] text-xs text-white font-bold rounded">S1: {currentDrivers[0]?.id || 'VER'}</span>
                                                    <span className="px-2 py-1 bg-[#FF8700] text-xs text-black font-bold rounded">S2: {currentDrivers[4]?.id || 'NOR'}</span>
                                                    <span className="px-2 py-1 bg-[#DC0000] text-xs text-white font-bold rounded">S3: {currentDrivers[3]?.id || 'LEC'}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </Card>
                                </div>
                                <div className="h-full">
                                    <Leaderboard drivers={currentDrivers} />
                                </div>
                                <div className="lg:col-span-3 h-64">
                                    <StrategyView lapData={lapData} stintData={stintData} drivers={currentDrivers} />
                                </div>
                            </div>
                        )}

                        {activeTab === 'telemetry' && <TelemetryView data={telemetryData} drivers={currentDrivers} />}
                        {activeTab === 'strategy' && <StrategyView lapData={lapData} stintData={stintData} drivers={currentDrivers} />}
                        {activeTab === 'comparison' && <ComparisonView drivers={currentDrivers} />}
                        {activeTab === 'standings' && <StandingsView year={selectedYear} drivers={currentDrivers} />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
