<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Telemetry Hub | Mission Control</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Prop Types (Required for Recharts UMD) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- Recharts for Visualization -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Styles for F1 Aesthetic -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,600;0,700;1,400&display=swap');
        
        body {
            font-family: 'Titillium Web', sans-serif;
            background-color: #0B0C10;
            color: #C5C6C7;
            overflow-x: hidden;
        }
        
        /* Scrollbar Customization */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1F2833; 
        }
        ::-webkit-scrollbar-thumb {
            background: #45A29E; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #66FCF1; 
        }

        /* F1 Specific Colors */
        .f1-red { color: #e10600; }
        .f1-bg-red { background-color: #e10600; }
        .tyre-soft { color: #ff3333; border-color: #ff3333; }
        .tyre-medium { color: #ffe600; border-color: #ffe600; }
        .tyre-hard { color: #f0f0f0; border-color: #f0f0f0; }
        .tyre-inter { color: #39b54a; border-color: #39b54a; }
        .tyre-wet { color: #0067c4; border-color: #0067c4; }

        .glass-panel {
            background: rgba(31, 40, 51, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(102, 252, 241, 0.1);
        }
        
        /* Table Styles */
        .standings-table th {
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            color: #66FCF1;
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(102, 252, 241, 0.2);
        }
        .standings-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .standings-table tr:hover {
            background-color: rgba(102, 252, 241, 0.05);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;
        
        // Ensure Recharts is loaded safely
        const Recharts = window.Recharts || {};
        const { 
            LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, 
            AreaChart, Area, ScatterChart, Scatter, BarChart, Bar, Cell, RadarChart, PolarGrid, 
            PolarAngleAxis, PolarRadiusAxis, Radar, PieChart, Pie 
        } = Recharts;

        // --- DATA CONSTANTS ---
        const YEARS = ['2025', '2024', '2023', '2022', '2021', '2020', '2019'];

        // REAL HISTORICAL DATA (Top 5 Drivers & Constructors)
        const HISTORICAL_DATA = {
            '2024': {
                drivers: [
                    { rank: 1, name: 'Max Verstappen', team: 'Red Bull Racing', points: 437, wins: 9, podiums: 14, color: '#1E41FF' },
                    { rank: 2, name: 'Lando Norris', team: 'McLaren', points: 374, wins: 3, podiums: 12, color: '#FF8700' },
                    { rank: 3, name: 'Charles Leclerc', team: 'Ferrari', points: 356, wins: 3, podiums: 12, color: '#DC0000' },
                    { rank: 4, name: 'Oscar Piastri', team: 'McLaren', points: 292, wins: 2, podiums: 7, color: '#FF8700' },
                    { rank: 5, name: 'Carlos Sainz', team: 'Ferrari', points: 290, wins: 2, podiums: 8, color: '#DC0000' }
                ],
                constructors: [
                    { rank: 1, name: 'McLaren', points: 666, wins: 5, color: '#FF8700' },
                    { rank: 2, name: 'Ferrari', points: 652, wins: 5, color: '#DC0000' },
                    { rank: 3, name: 'Red Bull Racing', points: 632, wins: 9, color: '#1E41FF' },
                    { rank: 4, name: 'Mercedes', points: 468, wins: 3, color: '#00D2BE' },
                    { rank: 5, name: 'Aston Martin', points: 86, wins: 0, color: '#006F62' }
                ]
            },
            '2023': {
                drivers: [
                    { rank: 1, name: 'Max Verstappen', team: 'Red Bull Racing', points: 575, wins: 19, podiums: 21, color: '#1E41FF' },
                    { rank: 2, name: 'Sergio Perez', team: 'Red Bull Racing', points: 285, wins: 2, podiums: 9, color: '#1E41FF' },
                    { rank: 3, name: 'Lewis Hamilton', team: 'Mercedes', points: 234, wins: 0, podiums: 6, color: '#00D2BE' },
                    { rank: 4, name: 'Fernando Alonso', team: 'Aston Martin', points: 206, wins: 0, podiums: 8, color: '#006F62' },
                    { rank: 5, name: 'Charles Leclerc', team: 'Ferrari', points: 206, wins: 0, podiums: 6, color: '#DC0000' }
                ],
                constructors: [
                    { rank: 1, name: 'Red Bull Racing', points: 860, wins: 21, color: '#1E41FF' },
                    { rank: 2, name: 'Mercedes', points: 409, wins: 0, color: '#00D2BE' },
                    { rank: 3, name: 'Ferrari', points: 406, wins: 1, color: '#DC0000' },
                    { rank: 4, name: 'McLaren', points: 302, wins: 0, color: '#FF8700' },
                    { rank: 5, name: 'Aston Martin', points: 280, wins: 0, color: '#006F62' }
                ]
            },
            '2022': {
                drivers: [
                    { rank: 1, name: 'Max Verstappen', team: 'Red Bull Racing', points: 454, wins: 15, podiums: 17, color: '#1E41FF' },
                    { rank: 2, name: 'Charles Leclerc', team: 'Ferrari', points: 308, wins: 3, podiums: 11, color: '#DC0000' },
                    { rank: 3, name: 'Sergio Perez', team: 'Red Bull Racing', points: 305, wins: 2, podiums: 11, color: '#1E41FF' },
                    { rank: 4, name: 'George Russell', team: 'Mercedes', points: 275, wins: 1, podiums: 8, color: '#00D2BE' },
                    { rank: 5, name: 'Carlos Sainz', team: 'Ferrari', points: 246, wins: 1, podiums: 9, color: '#DC0000' }
                ],
                constructors: [
                    { rank: 1, name: 'Red Bull Racing', points: 759, wins: 17, color: '#1E41FF' },
                    { rank: 2, name: 'Ferrari', points: 554, wins: 4, color: '#DC0000' },
                    { rank: 3, name: 'Mercedes', points: 515, wins: 1, color: '#00D2BE' },
                    { rank: 4, name: 'Alpine', points: 173, wins: 0, color: '#0090FF' },
                    { rank: 5, name: 'McLaren', points: 159, wins: 0, color: '#FF8700' }
                ]
            },
            '2021': {
                drivers: [
                    { rank: 1, name: 'Max Verstappen', team: 'Red Bull Racing', points: 395.5, wins: 10, podiums: 18, color: '#1E41FF' },
                    { rank: 2, name: 'Lewis Hamilton', team: 'Mercedes', points: 387.5, wins: 8, podiums: 17, color: '#00D2BE' },
                    { rank: 3, name: 'Valtteri Bottas', team: 'Mercedes', points: 226, wins: 1, podiums: 11, color: '#00D2BE' },
                    { rank: 4, name: 'Sergio Perez', team: 'Red Bull Racing', points: 190, wins: 1, podiums: 5, color: '#1E41FF' },
                    { rank: 5, name: 'Carlos Sainz', team: 'Ferrari', points: 164.5, wins: 0, podiums: 4, color: '#DC0000' }
                ],
                constructors: [
                    { rank: 1, name: 'Mercedes', points: 613.5, wins: 9, color: '#00D2BE' },
                    { rank: 2, name: 'Red Bull Racing', points: 585.5, wins: 11, color: '#1E41FF' },
                    { rank: 3, name: 'Ferrari', points: 323.5, wins: 0, color: '#DC0000' },
                    { rank: 4, name: 'McLaren', points: 275, wins: 1, color: '#FF8700' },
                    { rank: 5, name: 'Alpine', points: 155, wins: 1, color: '#0090FF' }
                ]
            },
            '2020': {
                drivers: [
                    { rank: 1, name: 'Lewis Hamilton', team: 'Mercedes', points: 347, wins: 11, podiums: 14, color: '#00D2BE' },
                    { rank: 2, name: 'Valtteri Bottas', team: 'Mercedes', points: 223, wins: 2, podiums: 11, color: '#00D2BE' },
                    { rank: 3, name: 'Max Verstappen', team: 'Red Bull Racing', points: 214, wins: 2, podiums: 11, color: '#1E41FF' },
                    { rank: 4, name: 'Sergio Perez', team: 'Racing Point', points: 125, wins: 1, podiums: 2, color: '#006F62' },
                    { rank: 5, name: 'Daniel Ricciardo', team: 'Renault', points: 119, wins: 0, podiums: 2, color: '#0090FF' }
                ],
                constructors: [
                    { rank: 1, name: 'Mercedes', points: 573, wins: 13, color: '#00D2BE' },
                    { rank: 2, name: 'Red Bull Racing', points: 319, wins: 2, color: '#1E41FF' },
                    { rank: 3, name: 'McLaren', points: 202, wins: 0, color: '#FF8700' },
                    { rank: 4, name: 'Racing Point', points: 195, wins: 1, color: '#006F62' },
                    { rank: 5, name: 'Renault', points: 181, wins: 0, color: '#0090FF' }
                ]
            },
            '2019': {
                drivers: [
                    { rank: 1, name: 'Lewis Hamilton', team: 'Mercedes', points: 413, wins: 11, podiums: 17, color: '#00D2BE' },
                    { rank: 2, name: 'Valtteri Bottas', team: 'Mercedes', points: 326, wins: 4, podiums: 15, color: '#00D2BE' },
                    { rank: 3, name: 'Max Verstappen', team: 'Red Bull Racing', points: 278, wins: 3, podiums: 9, color: '#1E41FF' },
                    { rank: 4, name: 'Charles Leclerc', team: 'Ferrari', points: 264, wins: 2, podiums: 10, color: '#DC0000' },
                    { rank: 5, name: 'Sebastian Vettel', team: 'Ferrari', points: 240, wins: 1, podiums: 9, color: '#DC0000' }
                ],
                constructors: [
                    { rank: 1, name: 'Mercedes', points: 739, wins: 15, color: '#00D2BE' },
                    { rank: 2, name: 'Ferrari', points: 504, wins: 3, color: '#DC0000' },
                    { rank: 3, name: 'Red Bull Racing', points: 417, wins: 3, color: '#1E41FF' },
                    { rank: 4, name: 'McLaren', points: 145, wins: 0, color: '#FF8700' },
                    { rank: 5, name: 'Renault', points: 91, wins: 0, color: '#0090FF' }
                ]
            }
        };

        // Hardcoded Tracks with Verified URLs
        const TRACKS = [
            { id: 'bahrain', name: 'Bahrain GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Bahrain_International_Circuit--Grand_Prix_Layout.svg/1024px-Bahrain_International_Circuit--Grand_Prix_Layout.svg.png' },
            { id: 'saudi', name: 'Saudi Arabian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1f/Jeddah_Street_Circuit_2021.svg/1024px-Jeddah_Street_Circuit_2021.svg.png' },
            { id: 'australia', name: 'Australian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Albert_Park_Circuit_2022.svg/1024px-Albert_Park_Circuit_2022.svg.png' },
            { id: 'japan', name: 'Japanese GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Suzuka_circuit_map_2005.svg/1024px-Suzuka_circuit_map_2005.svg.png' },
            { id: 'china', name: 'Chinese GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/14/Shanghai_International_Racing_Circuit_track_map.svg/1024px-Shanghai_International_Racing_Circuit_track_map.svg.png' },
            { id: 'miami', name: 'Miami GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/Miami_International_Autodrome_2022.svg/1024px-Miami_International_Autodrome_2022.svg.png' },
            { id: 'imola', name: 'Emilia Romagna GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Imola_2006.svg/1024px-Imola_2006.svg.png' },
            { id: 'monaco', name: 'Monaco GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Circuit_de_Monaco_2004.svg/1024px-Circuit_de_Monaco_2004.svg.png' },
            { id: 'canada', name: 'Canadian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Circuit_Gilles_Villeneuve_2002.svg/1024px-Circuit_Gilles_Villeneuve_2002.svg.png' },
            { id: 'spain', name: 'Spanish GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d8/Catalunya_2021.svg/1024px-Catalunya_2021.svg.png' },
            { id: 'austria', name: 'Austrian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/58/Red_Bull_Ring_2018.svg/1024px-Red_Bull_Ring_2018.svg.png' },
            { id: 'britain', name: 'British GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Silverstone_Circuit_2020.svg/1024px-Silverstone_Circuit_2020.svg.png' },
            { id: 'hungary', name: 'Hungarian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Hungaroring_2003.svg/1024px-Hungaroring_2003.svg.png' },
            { id: 'belgium', name: 'Belgian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/Circuit_de_Spa-Francorchamps_%282018%29.svg/1024px-Circuit_de_Spa-Francorchamps_%282018%29.svg.png' },
            { id: 'netherlands', name: 'Dutch GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Circuit_Zandvoort_2020.svg/1024px-Circuit_Zandvoort_2020.svg.png' },
            { id: 'monza', name: 'Italian GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Monza_track_map.svg/1024px-Monza_track_map.svg.png' },
            { id: 'baku', name: 'Azerbaijan GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/25/Baku_Formula_One_circuit_map.svg/1024px-Baku_Formula_One_circuit_map.svg.png' },
            { id: 'singapore', name: 'Singapore GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Marina_Bay_Street_Circuit_2023.svg/1024px-Marina_Bay_Street_Circuit_2023.svg.png' },
            { id: 'austin', name: 'United States GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Austin_circuit.svg/1024px-Austin_circuit.svg.png' },
            { id: 'mexico', name: 'Mexico City GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Aut%C3%B3dromo_Hermanos_Rodr%C3%ADguez_2015.svg/1024px-Aut%C3%B3dromo_Hermanos_Rodr%C3%ADguez_2015.svg.png' },
            { id: 'brazil', name: 'Sao Paulo GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Circuit_Interlagos.svg/1024px-Circuit_Interlagos.svg.png' },
            { id: 'vegas', name: 'Las Vegas GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Las_Vegas_Strip_Circuit_2023.svg/1024px-Las_Vegas_Strip_Circuit_2023.svg.png' },
            { id: 'qatar', name: 'Qatar GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Lusail_International_Circuit_2023.svg/1024px-Lusail_International_Circuit_2023.svg.png' },
            { id: 'abudhabi', name: 'Abu Dhabi GP', map: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b0/Yas_Marina_Circuit_2021.svg/1024px-Yas_Marina_Circuit_2021.svg.png' },
        ];

        // --- HELPER FUNCTIONS ---

        const getTeamColor = (teamName) => {
            if (teamName.includes('Red Bull')) return '#1E41FF';
            if (teamName.includes('Ferrari')) return '#DC0000';
            if (teamName.includes('Mercedes')) return '#00D2BE';
            if (teamName.includes('McLaren')) return '#FF8700';
            if (teamName.includes('Aston') || teamName.includes('Racing Point')) return '#006F62'; 
            if (teamName.includes('Alpine') || teamName.includes('Renault')) return '#0090FF'; 
            if (teamName.includes('Williams')) return '#005AFF';
            if (teamName.includes('RB') || teamName.includes('AlphaTauri') || teamName.includes('Toro Rosso')) return '#1634CC';
            if (teamName.includes('Sauber') || teamName.includes('Alfa')) return '#52E252'; 
            if (teamName.includes('Haas')) return '#B6BABD';
            return '#999999';
        };

        const getDriverGrid = (year) => {
            const drivers = [];
            // Helper to add driver
            const add = (id, name, team, num) => drivers.push({ id, name, team, number: num, color: getTeamColor(team) });

            if (year === '2025') {
                add('VER', 'Max Verstappen', 'Red Bull Racing', 1);
                add('PER', 'Sergio Perez', 'Red Bull Racing', 11);
                add('HAM', 'Lewis Hamilton', 'Ferrari', 44);
                add('LEC', 'Charles Leclerc', 'Ferrari', 16);
                add('NOR', 'Lando Norris', 'McLaren', 4);
                add('PIA', 'Oscar Piastri', 'McLaren', 81);
                add('RUS', 'George Russell', 'Mercedes', 63);
                add('ANT', 'Kimi Antonelli', 'Mercedes', 12);
                add('ALO', 'Fernando Alonso', 'Aston Martin', 14);
                add('STR', 'Lance Stroll', 'Aston Martin', 18);
                add('GAS', 'Pierre Gasly', 'Alpine', 10);
                add('DOO', 'Jack Doohan', 'Alpine', 7);
                add('ALB', 'Alexander Albon', 'Williams', 23);
                add('SAI', 'Carlos Sainz', 'Williams', 55);
                add('TSU', 'Yuki Tsunoda', 'RB', 22);
                add('LAW', 'Liam Lawson', 'RB', 30);
                add('HUL', 'Nico Hulkenberg', 'Sauber', 27);
                add('BOR', 'Gabriel Bortoleto', 'Sauber', 99);
                add('OCO', 'Esteban Ocon', 'Haas', 31);
                add('BEA', 'Ollie Bearman', 'Haas', 87);
            } else if (year === '2024') {
                add('VER', 'Max Verstappen', 'Red Bull Racing', 1);
                add('PER', 'Sergio Perez', 'Red Bull Racing', 11);
                add('HAM', 'Lewis Hamilton', 'Mercedes', 44);
                add('RUS', 'George Russell', 'Mercedes', 63);
                add('LEC', 'Charles Leclerc', 'Ferrari', 16);
                add('SAI', 'Carlos Sainz', 'Ferrari', 55);
                add('NOR', 'Lando Norris', 'McLaren', 4);
                add('PIA', 'Oscar Piastri', 'McLaren', 81);
                add('ALO', 'Fernando Alonso', 'Aston Martin', 14);
                add('STR', 'Lance Stroll', 'Aston Martin', 18);
                add('GAS', 'Pierre Gasly', 'Alpine', 10);
                add('OCO', 'Esteban Ocon', 'Alpine', 31);
                add('ALB', 'Alexander Albon', 'Williams', 23);
                add('SAR', 'Logan Sargeant', 'Williams', 2);
                add('TSU', 'Yuki Tsunoda', 'RB', 22);
                add('RIC', 'Daniel Ricciardo', 'RB', 3);
                add('BOT', 'Valtteri Bottas', 'Sauber', 77);
                add('ZHO', 'Zhou Guanyu', 'Sauber', 24);
                add('HUL', 'Nico Hulkenberg', 'Haas', 27);
                add('MAG', 'Kevin Magnussen', 'Haas', 20);
            } else if (year === '2023') {
                add('VER', 'Max Verstappen', 'Red Bull Racing', 1);
                add('PER', 'Sergio Perez', 'Red Bull Racing', 11);
                add('HAM', 'Lewis Hamilton', 'Mercedes', 44);
                add('RUS', 'George Russell', 'Mercedes', 63);
                add('LEC', 'Charles Leclerc', 'Ferrari', 16);
                add('SAI', 'Carlos Sainz', 'Ferrari', 55);
                add('ALO', 'Fernando Alonso', 'Aston Martin', 14);
                add('STR', 'Lance Stroll', 'Aston Martin', 18);
                add('NOR', 'Lando Norris', 'McLaren', 4);
                add('PIA', 'Oscar Piastri', 'McLaren', 81);
                add('GAS', 'Pierre Gasly', 'Alpine', 10);
                add('OCO', 'Esteban Ocon', 'Alpine', 31);
                add('ALB', 'Alexander Albon', 'Williams', 23);
                add('SAR', 'Logan Sargeant', 'Williams', 2);
                add('TSU', 'Yuki Tsunoda', 'AlphaTauri', 22);
                add('DEV', 'Nyck de Vries', 'AlphaTauri', 21);
                add('BOT', 'Valtteri Bottas', 'Alfa Romeo', 77);
                add('ZHO', 'Zhou Guanyu', 'Alfa Romeo', 24);
                add('HUL', 'Nico Hulkenberg', 'Haas', 27);
                add('MAG', 'Kevin Magnussen', 'Haas', 20);
            } else if (year === '2022') {
                add('VER', 'Max Verstappen', 'Red Bull Racing', 1);
                add('PER', 'Sergio Perez', 'Red Bull Racing', 11);
                add('LEC', 'Charles Leclerc', 'Ferrari', 16);
                add('SAI', 'Carlos Sainz', 'Ferrari', 55);
                add('HAM', 'Lewis Hamilton', 'Mercedes', 44);
                add('RUS', 'George Russell', 'Mercedes', 63);
                add('NOR', 'Lando Norris', 'McLaren', 4);
                add('RIC', 'Daniel Ricciardo', 'McLaren', 3);
                add('ALO', 'Fernando Alonso', 'Alpine', 14);
                add('OCO', 'Esteban Ocon', 'Alpine', 31);
                add('BOT', 'Valtteri Bottas', 'Alfa Romeo', 77);
                add('ZHO', 'Zhou Guanyu', 'Alfa Romeo', 24);
                add('VET', 'Sebastian Vettel', 'Aston Martin', 5);
                add('STR', 'Lance Stroll', 'Aston Martin', 18);
                add('GAS', 'Pierre Gasly', 'AlphaTauri', 10);
                add('TSU', 'Yuki Tsunoda', 'AlphaTauri', 22);
                add('MAG', 'Kevin Magnussen', 'Haas', 20);
                add('MSC', 'Mick Schumacher', 'Haas', 47);
                add('ALB', 'Alexander Albon', 'Williams', 23);
                add('LAT', 'Nicholas Latifi', 'Williams', 6);
            } else if (year === '2021') {
                add('VER', 'Max Verstappen', 'Red Bull Racing', 33);
                add('PER', 'Sergio Perez', 'Red Bull Racing', 11);
                add('HAM', 'Lewis Hamilton', 'Mercedes', 44);
                add('BOT', 'Valtteri Bottas', 'Mercedes', 77);
                add('LEC', 'Charles Leclerc', 'Ferrari', 16);
                add('SAI', 'Carlos Sainz', 'Ferrari', 55);
                add('NOR', 'Lando Norris', 'McLaren', 4);
                add('RIC', 'Daniel Ricciardo', 'McLaren', 3);
                add('VET', 'Sebastian Vettel', 'Aston Martin', 5);
                add('STR', 'Lance Stroll', 'Aston Martin', 18);
                add('ALO', 'Fernando Alonso', 'Alpine', 14);
                add('OCO', 'Esteban Ocon', 'Alpine', 31);
                add('GAS', 'Pierre Gasly', 'AlphaTauri', 10);
                add('TSU', 'Yuki Tsunoda', 'AlphaTauri', 22);
                add('RAI', 'Kimi Raikkonen', 'Alfa Romeo', 7);
                add('GIO', 'Antonio Giovinazzi', 'Alfa Romeo', 99);
                add('MSC', 'Mick Schumacher', 'Haas', 47);
                add('MAZ', 'Nikita Mazepin', 'Haas', 9);
                add('RUS', 'George Russell', 'Williams', 63);
                add('LAT', 'Nicholas Latifi', 'Williams', 6);
            } else if (year === '2020') {
                add('HAM', 'Lewis Hamilton', 'Mercedes', 44);
                add('BOT', 'Valtteri Bottas', 'Mercedes', 77);
                add('VER', 'Max Verstappen', 'Red Bull Racing', 33);
                add('ALB', 'Alexander Albon', 'Red Bull Racing', 23);
                add('VET', 'Sebastian Vettel', 'Ferrari', 5);
                add('LEC', 'Charles Leclerc', 'Ferrari', 16);
                add('SAI', 'Carlos Sainz', 'McLaren', 55);
                add('NOR', 'Lando Norris', 'McLaren', 4);
                add('RIC', 'Daniel Ricciardo', 'Renault', 3);
                add('OCO', 'Esteban Ocon', 'Renault', 31);
                add('PER', 'Sergio Perez', 'Racing Point', 11);
                add('STR', 'Lance Stroll', 'Racing Point', 18);
                add('GAS', 'Pierre Gasly', 'AlphaTauri', 10);
                add('KVY', 'Daniil Kvyat', 'AlphaTauri', 26);
                add('RAI', 'Kimi Raikkonen', 'Alfa Romeo', 7);
                add('GIO', 'Antonio Giovinazzi', 'Alfa Romeo', 99);
                add('GRO', 'Romain Grosjean', 'Haas', 8);
                add('MAG', 'Kevin Magnussen', 'Haas', 20);
                add('RUS', 'George Russell', 'Williams', 63);
                add('LAT', 'Nicholas Latifi', 'Williams', 6);
            } else if (year === '2019') {
                add('HAM', 'Lewis Hamilton', 'Mercedes', 44);
                add('BOT', 'Valtteri Bottas', 'Mercedes', 77);
                add('VET', 'Sebastian Vettel', 'Ferrari', 5);
                add('LEC', 'Charles Leclerc', 'Ferrari', 16);
                add('VER', 'Max Verstappen', 'Red Bull Racing', 33);
                add('GAS', 'Pierre Gasly', 'Red Bull Racing', 10);
                add('SAI', 'Carlos Sainz', 'McLaren', 55);
                add('NOR', 'Lando Norris', 'McLaren', 4);
                add('RIC', 'Daniel Ricciardo', 'Renault', 3);
                add('HUL', 'Nico Hulkenberg', 'Renault', 27);
                add('PER', 'Sergio Perez', 'Racing Point', 11);
                add('STR', 'Lance Stroll', 'Racing Point', 18);
                add('KVY', 'Daniil Kvyat', 'Toro Rosso', 26);
                add('ALB', 'Alexander Albon', 'Toro Rosso', 23);
                add('RAI', 'Kimi Raikkonen', 'Alfa Romeo', 7);
                add('GIO', 'Antonio Giovinazzi', 'Alfa Romeo', 99);
                add('GRO', 'Romain Grosjean', 'Haas', 8);
                add('MAG', 'Kevin Magnussen', 'Haas', 20);
                add('RUS', 'George Russell', 'Williams', 63);
                add('KUB', 'Robert Kubica', 'Williams', 88);
            }
            return drivers;
        };

        // --- COMPONENTS ---

        const Icon = ({ name, size = 20, color = "currentColor" }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (window.lucide && containerRef.current) {
                    containerRef.current.innerHTML = '';
                    const i = document.createElement('i');
                    i.setAttribute('data-lucide', name);
                    containerRef.current.appendChild(i);
                    window.lucide.createIcons({ root: containerRef.current, attrs: { width: size, height: size, stroke: color } });
                }
            }, [name, size, color]);
            return <span ref={containerRef} style={{ display: 'inline-flex' }} />;
        };

        const Card = ({ title, children, className = "" }) => (
            <div className={`glass-panel rounded-xl p-4 flex flex-col h-full ${className}`}>
                <h3 className="text-gray-400 text-sm font-bold uppercase tracking-widest mb-4 flex items-center gap-2">
                    {title}
                </h3>
                <div className="flex-1 min-h-0 relative">
                    {children}
                </div>
            </div>
        );

        const Navbar = ({ activeTab, setActiveTab, selectedYear, setSelectedYear, selectedTrack, setSelectedTrack }) => {
            const tabs = [
                { id: 'overview', label: 'Overview', icon: 'layout-dashboard' },
                { id: 'telemetry', label: 'Telemetry', icon: 'activity' },
                { id: 'strategy', label: 'Strategy', icon: 'git-merge' },
                { id: 'comparison', label: 'Comparison', icon: 'users' },
                { id: 'standings', label: 'Standings', icon: 'trophy' },
            ];

            return (
                <nav className="bg-[#0B0C10] border-b border-gray-800 px-6 py-3 flex flex-col md:flex-row justify-between items-center sticky top-0 z-50 gap-4">
                    <div className="flex items-center gap-3">
                        <div className="w-8 h-8 bg-red-600 rounded-md flex items-center justify-center font-black italic text-white">F1</div>
                        <span className="font-bold text-xl tracking-tighter hidden sm:block">DATA HUB</span>
                    </div>

                    <div className="flex gap-4 items-center">
                        <div className="relative">
                             <select 
                                value={selectedYear}
                                onChange={(e) => setSelectedYear(e.target.value)}
                                className="bg-[#1F2833] text-white text-sm font-bold py-1 px-3 rounded border border-gray-700 focus:border-[#66FCF1] outline-none appearance-none pr-8 cursor-pointer"
                            >
                                {YEARS.map(y => <option key={y} value={y}>{y}</option>)}
                            </select>
                            <div className="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 flex items-center"><Icon name="chevron-down" size={12} /></div>
                        </div>
                         <div className="relative">
                             <select 
                                value={selectedTrack?.id || ''}
                                onChange={(e) => {
                                    const track = TRACKS.find(t => t.id == e.target.value);
                                    if(track) setSelectedTrack(track);
                                }}
                                className="bg-[#1F2833] text-white text-sm font-bold py-1 px-3 rounded border border-gray-700 focus:border-[#66FCF1] outline-none appearance-none pr-8 cursor-pointer min-w-[160px] max-w-[200px]"
                            >
                                {TRACKS.map(t => <option key={t.id} value={t.id}>{t.name}</option>)}
                            </select>
                            <div className="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 flex items-center"><Icon name="chevron-down" size={12} /></div>
                        </div>
                    </div>

                    <div className="flex gap-2 bg-[#1F2833] p-1 rounded-lg overflow-x-auto max-w-full">
                        {tabs.map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id)}
                                className={`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap ${
                                    activeTab === tab.id 
                                    ? 'bg-[#66FCF1] text-[#0B0C10] shadow-lg shadow-[#66FCF1]/20' 
                                    : 'text-gray-400 hover:text-white hover:bg-white/5'
                                }`}
                            >
                                <Icon name={tab.icon} size={16} />
                                {tab.label}
                            </button>
                        ))}
                    </div>
                </nav>
            );
        };

        const StandingsView = ({ year, drivers }) => {
            const [viewType, setViewType] = useState('drivers');

            const data = useMemo(() => {
                // Use real historical data if available, otherwise simulate
                if (HISTORICAL_DATA[year]) {
                    const historyData = HISTORICAL_DATA[year];
                    
                    const totalRounds = 24;
                    const generateHistory = (entities) => {
                        const history = Array.from({ length: totalRounds }, (_, i) => ({ round: i + 1 }));
                        entities.forEach(entity => {
                            const finalScore = entity.points;
                            let currentScore = 0;
                            history.forEach((h, idx) => {
                                const progress = (idx + 1) / totalRounds;
                                // Smooth curve to final points
                                let estimatedScore = finalScore * Math.pow(progress, 1.2); 
                                if (idx === totalRounds - 1) estimatedScore = finalScore;
                                h[entity.id || entity.name] = Math.floor(estimatedScore);
                            });
                        });
                        return history;
                    };

                    return {
                        drivers: historyData.drivers,
                        constructors: historyData.constructors,
                        driverHistory: generateHistory(historyData.drivers),
                        constructorHistory: generateHistory(historyData.constructors)
                    };
                }

                // Fallback for 2025 (Simulation)
                let driverStandings = drivers.map((d, index) => {
                    const seed = d.number * parseInt(year);
                    let basePoints = 0;
                    if(d.team.includes('Red Bull')) basePoints = 400;
                    else if(d.team.includes('Ferrari') || d.team.includes('Mercedes') || d.team.includes('McLaren')) basePoints = 300;
                    else if(d.team.includes('Aston')) basePoints = 200;
                    else basePoints = 50;

                    const points = Math.max(0, Math.floor(basePoints + (Math.sin(seed) * 100)));
                    return { ...d, points, wins: Math.floor(points/40), podiums: Math.floor(points/20) };
                }).sort((a, b) => b.points - a.points);

                driverStandings = driverStandings.map((d, i) => ({ ...d, rank: i + 1 }));

                const teamMap = {};
                driverStandings.forEach(d => {
                    if(!teamMap[d.team]) {
                        teamMap[d.team] = { 
                            id: d.team.replace(/\s+/g, '').toLowerCase(),
                            name: d.team, 
                            points: 0, 
                            wins: 0,
                            color: d.color
                        };
                    }
                    teamMap[d.team].points += d.points;
                    teamMap[d.team].wins += d.wins;
                });
                
                let constructorStandings = Object.values(teamMap).sort((a, b) => b.points - a.points);
                constructorStandings = constructorStandings.map((c, i) => ({ ...c, rank: i + 1 }));

                const totalRounds = 24;
                const generateHistory = (entities) => {
                    const history = Array.from({ length: totalRounds }, (_, i) => ({ round: i + 1 }));
                    entities.slice(0, 5).forEach(entity => {
                        let currentScore = 0;
                        const finalScore = entity.points;
                        history.forEach((h, idx) => {
                            const progress = (idx + 1) / totalRounds;
                            const variance = (Math.random() - 0.5) * 20 * progress; 
                            let estimatedScore = (finalScore * progress) + variance;
                            estimatedScore = Math.max(0, Math.floor(estimatedScore));
                            if (idx === totalRounds - 1) estimatedScore = finalScore;
                            if (estimatedScore < currentScore) estimatedScore = currentScore;
                            h[entity.id] = estimatedScore;
                            currentScore = estimatedScore;
                        });
                    });
                    return history;
                };

                return { 
                    drivers: driverStandings, 
                    constructors: constructorStandings,
                    driverHistory: generateHistory(driverStandings),
                    constructorHistory: generateHistory(constructorStandings)
                };
            }, [year, drivers]);

            const currentHistory = viewType === 'drivers' ? data.driverHistory : data.constructorHistory;
            const entities = viewType === 'drivers' ? data.drivers : data.constructors;
            const winData = entities.filter(e => e.wins > 0);

            return (
                <div className="h-full flex flex-col gap-4">
                    <div className="flex gap-4 justify-center mb-4">
                        <button onClick={() => setViewType('drivers')} className={`px-6 py-2 rounded-full font-bold text-sm transition-all ${viewType === 'drivers' ? 'bg-[#e10600] text-white' : 'bg-gray-800 text-gray-400'}`}>DRIVER STANDINGS</button>
                        <button onClick={() => setViewType('constructors')} className={`px-6 py-2 rounded-full font-bold text-sm transition-all ${viewType === 'constructors' ? 'bg-[#e10600] text-white' : 'bg-gray-800 text-gray-400'}`}>CONSTRUCTOR STANDINGS</button>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
                        <div className="lg:col-span-2 h-full overflow-hidden flex flex-col">
                             <Card title={`World Championship Standings - ${year}`}>
                                <div className="overflow-y-auto h-full pr-2">
                                    <table className="w-full standings-table text-sm">
                                        <thead>
                                            <tr>
                                                <th className="w-16 text-center">Pos</th>
                                                <th>{viewType === 'drivers' ? 'Driver' : 'Team'}</th>
                                                {viewType === 'drivers' && <th>Team</th>}
                                                <th className="text-right">Wins</th>
                                                <th className="text-right">Points</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {entities.map((item) => (
                                                <tr key={item.rank} className="group transition-colors">
                                                    <td className="text-center font-mono font-bold text-xl text-gray-500 group-hover:text-white">{item.rank}</td>
                                                    <td>
                                                        <div className="flex items-center gap-3">
                                                            <div className="w-1 h-8 rounded-full" style={{ backgroundColor: item.color }}></div>
                                                            <div>
                                                                <div className="font-bold text-white text-lg">{item.name}</div>
                                                                {viewType === 'drivers' && <div className="text-xs text-gray-400">#{item.number}</div>}
                                                            </div>
                                                        </div>
                                                    </td>
                                                    {viewType === 'drivers' && <td className="text-gray-300">{item.team}</td>}
                                                    <td className="text-right font-mono text-gray-400">{item.wins}</td>
                                                    <td className="text-right"><span className="bg-[#1F2833] px-3 py-1 rounded-md font-mono font-bold text-[#66FCF1]">{item.points} PTS</span></td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </Card>
                        </div>

                        <div className="flex flex-col gap-6">
                            {currentHistory && currentHistory.length > 0 && (
                                <Card title="Season Progression">
                                    <ResponsiveContainer width="100%" height={250}>
                                        <LineChart data={currentHistory}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                            <XAxis dataKey="round" stroke="#666" tick={{fontSize: 10}} interval={3} />
                                            <YAxis stroke="#666" width={30} tick={{fontSize: 10}} />
                                            <Tooltip contentStyle={{ backgroundColor: '#1F2833', border: '1px solid #45A29E' }} />
                                            <Legend wrapperStyle={{ fontSize: '10px' }} />
                                            {entities.slice(0, 5).map((entity) => (
                                                <Line key={entity.id || entity.name} type="monotone" dataKey={entity.id || entity.name} stroke={entity.color} strokeWidth={2} dot={false} name={entity.name} />
                                            ))}
                                        </LineChart>
                                    </ResponsiveContainer>
                                </Card>
                            )}
                            
                            <div className="grid grid-cols-1 gap-4 h-full">
                                <Card title="Victory Share (Top 5)">
                                    <div className="flex items-center justify-center h-full">
                                        <ResponsiveContainer width="100%" height={200}>
                                            <PieChart>
                                                <Pie data={winData} cx="50%" cy="50%" innerRadius={40} outerRadius={70} paddingAngle={5} dataKey="wins">
                                                    {winData.map((entry, index) => <Cell key={`cell-${index}`} fill={entry.color} stroke="rgba(0,0,0,0.5)" />)}
                                                </Pie>
                                                <Tooltip contentStyle={{ backgroundColor: '#1F2833', borderRadius: '8px' }} itemStyle={{color: '#fff'}} />
                                            </PieChart>
                                        </ResponsiveContainer>
                                    </div>
                                </Card>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const TelemetryView = ({ data, drivers }) => {
            const [selectedDrivers, setSelectedDrivers] = useState([]);
            
            useEffect(() => {
                if (drivers && drivers.length > 0) {
                    setSelectedDrivers([drivers[0].id, drivers[1]?.id]);
                }
            }, [drivers]);

            if (!LineChart) return <div className="p-4 text-red-500">Error loading charts. Please refresh.</div>;

            const handleDriverToggle = (driverId) => {
                if (selectedDrivers.includes(driverId)) {
                    if (selectedDrivers.length > 1) setSelectedDrivers(prev => prev.filter(id => id !== driverId));
                } else {
                    if (selectedDrivers.length < 4) setSelectedDrivers(prev => [...prev, driverId]);
                }
            };

            return (
                <div className="grid grid-cols-1 lg:grid-cols-4 gap-6 h-full">
                    <div className="lg:col-span-3 flex flex-col gap-6">
                        <Card title="Speed Trace (km/h)">
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={data}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                    <XAxis dataKey="distance" hide />
                                    <YAxis domain={['auto', 'auto']} stroke="#666" />
                                    <Tooltip contentStyle={{ backgroundColor: '#1F2833', border: '1px solid #45A29E' }} />
                                    <Legend />
                                    {selectedDrivers.map(id => {
                                        const driver = drivers.find(d => d.id === id);
                                        return driver ? <Line key={id} type="monotone" dataKey={`${id}_speed`} stroke={driver.color} dot={false} strokeWidth={2} name={`${id} Speed`} /> : null;
                                    })}
                                </LineChart>
                            </ResponsiveContainer>
                        </Card>
                        <div className="grid grid-cols-2 gap-6 h-64">
                            <Card title="Throttle Input (%)">
                                <ResponsiveContainer width="100%" height="100%">
                                    <LineChart data={data}>
                                        <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                        <XAxis dataKey="distance" hide />
                                        <YAxis domain={[0, 100]} hide />
                                        <Tooltip contentStyle={{ backgroundColor: '#1F2833', border: '1px solid #45A29E' }} />
                                        {selectedDrivers.map(id => {
                                            const driver = drivers.find(d => d.id === id);
                                            return driver ? <Line key={id} type="step" dataKey={`${id}_throttle`} stroke={driver.color} dot={false} strokeWidth={2} name={id} /> : null;
                                        })}
                                    </LineChart>
                                </ResponsiveContainer>
                            </Card>
                            <Card title="Brake Pressure">
                                <ResponsiveContainer width="100%" height="100%">
                                    <LineChart data={data}>
                                        <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                        <XAxis dataKey="distance" hide />
                                        <YAxis domain={[0, 100]} hide />
                                        <Tooltip contentStyle={{ backgroundColor: '#1F2833', border: '1px solid #45A29E' }} />
                                        {selectedDrivers.map(id => {
                                            const driver = drivers.find(d => d.id === id);
                                            return driver ? <Line key={id} type="monotone" dataKey={`${id}_brake`} stroke={driver.color} dot={false} strokeWidth={2} name={id} /> : null;
                                        })}
                                    </LineChart>
                                </ResponsiveContainer>
                            </Card>
                        </div>
                    </div>
                    <div className="flex flex-col gap-4 h-full">
                        <Card title="Driver Select" className="flex flex-col">
                            <div className="flex-1 overflow-y-auto pr-2 space-y-2 max-h-[600px]">
                                {drivers.map(d => (
                                    <button key={d.id} onClick={() => handleDriverToggle(d.id)} className={`w-full p-2 rounded flex items-center justify-between border transition-all text-sm ${selectedDrivers.includes(d.id) ? 'bg-white/10 border-[#66FCF1]' : 'border-transparent hover:bg-white/5 border-gray-800'}`}>
                                        <div className="flex items-center gap-3">
                                            <div className="w-1 h-6 rounded-full" style={{ backgroundColor: d.color }}></div>
                                            <div className="text-left">
                                                <div className="font-bold text-white leading-none">{d.id}</div>
                                                <div className="text-[10px] text-gray-400">{d.team}</div>
                                            </div>
                                        </div>
                                        {selectedDrivers.includes(d.id) && <Icon name="check" size={14} color="#66FCF1" />}
                                    </button>
                                ))}
                            </div>
                        </Card>
                    </div>
                </div>
            );
        };

        const StrategyView = ({ lapData, stintData, drivers }) => {
            if (!ScatterChart) return <div className="p-4 text-red-500">Error loading charts. Please refresh.</div>;

            // Simplified logic for strategy visualization based on simulated laps
            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
                    <div className="lg:col-span-3 h-48">
                        <Card title="Tyre Strategy Overview">
                            <div className="w-full h-full flex flex-col justify-around px-4 overflow-y-auto">
                                {stintData.slice(0, 8).map((d, idx) => (
                                    <div key={idx} className="flex items-center gap-4 mb-2">
                                        <div className="w-16 font-bold text-white text-right text-xs">{d.driver}</div>
                                        <div className="flex-1 h-6 bg-gray-800 rounded-full relative overflow-hidden flex">
                                            {d.stints.map((stint, sIdx) => {
                                                const width = ((stint.end - stint.start) / 53) * 100;
                                                const color = stint.tyre === 'S' ? '#ff3333' : stint.tyre === 'M' ? '#ffe600' : '#f0f0f0';
                                                return <div key={sIdx} style={{ width: `${width}%`, backgroundColor: color }} className="h-full border-r border-black/20 flex items-center justify-center text-[9px] text-black font-bold">{stint.tyre}</div>;
                                            })}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </Card>
                    </div>
                    <div className="lg:col-span-2 h-80">
                        <Card title="Gap to Leader">
                            <ResponsiveContainer width="100%" height="100%">
                                <AreaChart data={lapData.filter(l => l.driver === (drivers[1]?.id || 'NOR') && l.lap <= 30)}>
                                    <defs><linearGradient id="colorGap" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#66FCF1" stopOpacity={0.8}/><stop offset="95%" stopColor="#66FCF1" stopOpacity={0}/></linearGradient></defs>
                                    <XAxis dataKey="lap" stroke="#666" />
                                    <YAxis label={{ value: 'Gap (s)', angle: -90, position: 'insideLeft' }} stroke="#666" />
                                    <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                    <Tooltip contentStyle={{ backgroundColor: '#1F2833' }}/>
                                    <Area type="monotone" dataKey="time" stroke="#66FCF1" fillOpacity={1} fill="url(#colorGap)" />
                                </AreaChart>
                            </ResponsiveContainer>
                        </Card>
                    </div>
                    <div className="lg:col-span-1 h-80">
                        <Card title="Strategy Predictions">
                            <div className="flex flex-col justify-between h-full p-2">
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center border-b border-gray-800 pb-2"><span className="text-gray-400 text-sm">Optimal Pit Window</span><span className="text-[#66FCF1] font-bold font-mono">Laps 22-25</span></div>
                                    <div className="flex justify-between items-center border-b border-gray-800 pb-2"><span className="text-gray-400 text-sm">Undercut Power</span><span className="text-red-500 font-bold font-mono">High (2.5s)</span></div>
                                </div>
                            </div>
                        </Card>
                    </div>
                </div>
            );
        };

        const Leaderboard = ({ drivers }) => (
            <Card title="Live Standings (Lap 53/53)" className="overflow-hidden">
                <div className="overflow-y-auto pr-2">
                    <table className="w-full text-sm">
                        <thead className="text-xs text-gray-500 border-b border-gray-700">
                            <tr><th className="text-left py-2">Pos</th><th className="text-left py-2">Driver</th><th className="text-right py-2">Gap</th><th className="text-center py-2">Tyre</th></tr>
                        </thead>
                        <tbody>
                            {drivers.slice(0, 10).map((d, i) => (
                                <tr key={d.id} className="border-b border-white/5 hover:bg-white/5 transition-colors">
                                    <td className="py-3 font-mono text-[#66FCF1] font-bold">{i + 1}</td>
                                    <td className="py-3"><div className="flex items-center gap-2"><span className="w-1 h-4" style={{ backgroundColor: d.color }}></span><span className="font-bold text-white">{d.name.split(' ')[1]}</span></div></td>
                                    <td className="py-3 text-right font-mono text-gray-300">{i === 0 ? 'Leader' : `+${(Math.random() * 5 + (i * 2)).toFixed(3)}`}</td>
                                    <td className="py-3 text-center"><span className={`inline-block w-6 h-6 rounded-full border-4 flex items-center justify-center text-[10px] font-bold bg-gray-900 ${i % 2 === 0 ? 'tyre-hard' : 'tyre-medium'}`}>{i % 2 === 0 ? 'H' : 'M'}</span></td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </Card>
        );

        const ComparisonView = ({ drivers }) => {
            const [d1, setD1] = useState(drivers[0]);
            const [d2, setD2] = useState(drivers[1] || drivers[0]);

            useEffect(() => { setD1(drivers[0]); setD2(drivers[1] || drivers[0]); }, [drivers]);

            if (!d1 || !d2) return <div>Loading...</div>;

            const radarData = [
                { subject: 'Quali Pace', A: 120, B: 110, fullMark: 150 },
                { subject: 'Race Pace', A: 98, B: 130, fullMark: 150 },
                { subject: 'Tyre Mgmt', A: 86, B: 130, fullMark: 150 },
                { subject: 'Overtaking', A: 99, B: 100, fullMark: 150 },
                { subject: 'Consistency', A: 85, B: 90, fullMark: 150 },
                { subject: 'Defense', A: 65, B: 85, fullMark: 150 },
            ];

            const barData = [
                { range: '1:21', [d1.id]: 12, [d2.id]: 10 },
                { range: '1:22', [d1.id]: 15, [d2.id]: 18 },
                { range: '1:23', [d1.id]: 20, [d2.id]: 22 },
                { range: '1:24+', [d1.id]: 5, [d2.id]: 3 },
            ];
            
            return (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 h-full">
                    <Card title="Driver Head-to-Head Selector">
                        <div className="flex justify-between items-center mb-4 px-4 gap-4">
                            <div className="flex-1">
                                <select className="w-full bg-[#1F2833] text-white p-2 rounded border border-gray-700 mb-2 font-bold" value={d1.id} onChange={(e) => setD1(drivers.find(d => d.id === e.target.value))}>
                                    {drivers.map(d => <option key={d.id} value={d.id}>{d.name}</option>)}
                                </select>
                                <div className="text-center"><div className="w-20 h-20 mx-auto rounded-full flex items-center justify-center text-2xl font-bold border-4 shadow-[0_0_20px_rgba(255,255,255,0.1)]" style={{ borderColor: d1.color }}>{d1.number}</div><h2 className="mt-2 text-xl font-bold text-white">{d1.id}</h2></div>
                            </div>
                            <div className="text-2xl font-black italic text-gray-600">VS</div>
                            <div className="flex-1">
                                <select className="w-full bg-[#1F2833] text-white p-2 rounded border border-gray-700 mb-2 font-bold" value={d2.id} onChange={(e) => setD2(drivers.find(d => d.id === e.target.value))}>
                                    {drivers.map(d => <option key={d.id} value={d.id}>{d.name}</option>)}
                                </select>
                                <div className="text-center"><div className="w-20 h-20 mx-auto rounded-full flex items-center justify-center text-2xl font-bold border-4 shadow-[0_0_20px_rgba(255,255,255,0.1)]" style={{ borderColor: d2.color }}>{d2.number}</div><h2 className="mt-2 text-xl font-bold text-white">{d2.id}</h2></div>
                            </div>
                        </div>
                        <div className="h-64">
                            <ResponsiveContainer width="100%" height="100%">
                                <RadarChart cx="50%" cy="50%" outerRadius="80%" data={radarData}>
                                    <PolarGrid stroke="#333" />
                                    <PolarAngleAxis dataKey="subject" tick={{ fill: '#999', fontSize: 12 }} />
                                    <PolarRadiusAxis angle={30} domain={[0, 150]} tick={false} axisLine={false} />
                                    <Radar name={d1.name} dataKey="A" stroke={d1.color} strokeWidth={2} fill={d1.color} fillOpacity={0.3} />
                                    <Radar name={d2.name} dataKey="B" stroke={d2.color} strokeWidth={2} fill={d2.color} fillOpacity={0.3} />
                                    <Legend />
                                </RadarChart>
                            </ResponsiveContainer>
                        </div>
                    </Card>
                    <div className="flex flex-col gap-6">
                        <Card title="Lap Time Distribution Comparison">
                             <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={barData}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#333" vertical={false} />
                                    <XAxis dataKey="range" stroke="#666" />
                                    <Tooltip cursor={{fill: 'transparent'}} contentStyle={{ backgroundColor: '#1F2833' }} />
                                    <Legend />
                                    <Bar dataKey={d1.id} fill={d1.color} radius={[4, 4, 0, 0]} name={d1.id} />
                                    <Bar dataKey={d2.id} fill={d2.color} radius={[4, 4, 0, 0]} name={d2.id} />
                                </BarChart>
                            </ResponsiveContainer>
                        </Card>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('overview');
            const [selectedYear, setSelectedYear] = useState('2025');
            const [selectedTrack, setSelectedTrack] = useState(TRACKS[0]);

            const currentDrivers = useMemo(() => getDriverGrid(selectedYear), [selectedYear]);

            const telemetryData = useMemo(() => {
                const data = [];
                for (let i = 0; i <= 100; i++) {
                    const dist = i;
                    let baseSpeed = 0, throttle = 0, brake = 0;
                    // Simple track shape
                    if (dist < 20) { baseSpeed = 100 + (dist * 10); throttle = 100; brake = 0; }
                    else if (dist < 30) { baseSpeed = 300 - ((dist - 20) * 20); throttle = 0; brake = 100; }
                    else if (dist < 50) { baseSpeed = 100 + ((dist - 30) * 8); throttle = 80; brake = 0; }
                    else { baseSpeed = 220; throttle = 100; brake = 0; }
                    
                    const point = { distance: dist };
                    currentDrivers.forEach(d => {
                        const jitter = (d.number % 5) - 2.5; 
                        point[`${d.id}_speed`] = baseSpeed + jitter + (Math.random() * 4);
                        point[`${d.id}_throttle`] = throttle > 0 ? Math.min(100, throttle + jitter) : 0;
                        point[`${d.id}_brake`] = brake > 0 ? Math.min(100, brake - jitter) : 0;
                    });
                    data.push(point);
                }
                return data;
            }, [currentDrivers]);

            const lapData = useMemo(() => {
                const laps = [];
                currentDrivers.forEach(driver => {
                    let currentTyre = 'Medium';
                    let tyreAge = 0;
                    for (let i = 1; i <= 50; i++) {
                        if (i === 20) currentTyre = 'Hard';
                        let time = 82.5 + (tyreAge * 0.05) - (i * 0.03) + (Math.random() - 0.5) * 0.4;
                        if (i === 20) time += 20;
                        tyreAge++;
                        if (i === 20) tyreAge = 0;
                        laps.push({ lap: i, driver: driver.id, time: parseFloat(time.toFixed(3)), tyre: currentTyre });
                    }
                });
                return laps;
            }, [currentDrivers]);

            const stintData = useMemo(() => {
                return currentDrivers.map((d, i) => ({
                    driver: d.id,
                    stints: i % 2 === 0 
                        ? [{ start: 1, end: 22, tyre: 'M' }, { start: 23, end: 53, tyre: 'H' }]
                        : [{ start: 1, end: 18, tyre: 'S' }, { start: 19, end: 40, tyre: 'H' }, { start: 41, end: 53, tyre: 'S' }]
                }));
            }, [currentDrivers]);

            return (
                <div className="min-h-screen bg-[#0B0C10] pb-8">
                    <Navbar 
                        activeTab={activeTab} 
                        setActiveTab={setActiveTab} 
                        selectedYear={selectedYear}
                        setSelectedYear={setSelectedYear}
                        selectedTrack={selectedTrack}
                        setSelectedTrack={setSelectedTrack}
                    />
                    
                    <main className="container mx-auto px-6 py-8 h-[calc(100vh-80px)]">
                        {activeTab === 'overview' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
                                <div className="lg:col-span-2 h-full">
                                    <Card title="Track Dominance Map (Sector Analysis)">
                                        <div className="w-full h-full flex items-center justify-center relative overflow-hidden">
                                            <img 
                                                src={selectedTrack.map} 
                                                alt={selectedTrack.name}
                                                className="absolute inset-0 w-full h-full object-contain p-4 opacity-80 hover:opacity-100 transition-opacity duration-500"
                                                onError={(e) => {
                                                    e.target.onerror = null;
                                                    e.target.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Monza_track_map.svg/512px-Monza_track_map.svg.png'; 
                                                    e.target.style.opacity = 0.3;
                                                }}
                                            />
                                            <div className="absolute inset-0 bg-black/20 pointer-events-none"></div>
                                            <div className="relative z-10 text-center mt-auto mb-4">
                                                <h2 className="text-4xl font-black italic text-white mb-2 uppercase drop-shadow-lg">{selectedTrack.name}</h2>
                                                <div className="flex gap-4 justify-center">
                                                    <span className="px-2 py-1 bg-[#1E41FF] text-xs text-white font-bold rounded shadow-md">S1: {currentDrivers[0]?.id || 'VER'}</span>
                                                    <span className="px-2 py-1 bg-[#FF8700] text-xs text-black font-bold rounded shadow-md">S2: {currentDrivers[4]?.id || 'NOR'}</span>
                                                    <span className="px-2 py-1 bg-[#DC0000] text-xs text-white font-bold rounded shadow-md">S3: {currentDrivers[3]?.id || 'LEC'}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </Card>
                                </div>
                                <div className="h-full">
                                    <Leaderboard drivers={currentDrivers} />
                                </div>
                                <div className="lg:col-span-3 h-64">
                                    <StrategyView lapData={lapData} stintData={stintData} drivers={currentDrivers} />
                                </div>
                            </div>
                        )}

                        {activeTab === 'telemetry' && <TelemetryView data={telemetryData} drivers={currentDrivers} />}
                        {activeTab === 'strategy' && <StrategyView lapData={lapData} stintData={stintData} drivers={currentDrivers} />}
                        {activeTab === 'comparison' && <ComparisonView drivers={currentDrivers} />}
                        {activeTab === 'standings' && <StandingsView year={selectedYear} drivers={currentDrivers} />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
